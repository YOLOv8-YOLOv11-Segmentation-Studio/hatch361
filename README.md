# äº•ç›–å¼€é—­çŠ¶æ€åˆ†ç±»å›¾åƒåˆ†å‰²ç³»ç»Ÿï¼š yolov8-seg-EfficientFormerV2

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

[å‚è€ƒåšå®¢](https://gitee.com/YOLOv8_YOLOv11_Segmentation_Studio/projects)

[åšå®¢æ¥æº](https://kdocs.cn/l/cszuIiCKVNis)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€åŸå¸‚åŒ–è¿›ç¨‹çš„åŠ å¿«ï¼ŒåŸå¸‚åŸºç¡€è®¾æ–½çš„ç®¡ç†ä¸ç»´æŠ¤å˜å¾—æ„ˆå‘é‡è¦ã€‚äº•ç›–ä½œä¸ºåŸå¸‚æ’æ°´ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå…¶å¼€é—­çŠ¶æ€çš„ç›‘æµ‹ä¸ä»…å…³ç³»åˆ°åŸå¸‚äº¤é€šçš„å®‰å…¨ä¸ç•…é€šï¼Œè¿˜ç›´æ¥å½±å“åˆ°å¸‚æ°‘çš„ç”Ÿæ´»è´¨é‡å’Œå…¬å…±å®‰å…¨ã€‚ä¼ ç»Ÿçš„äº•ç›–çŠ¶æ€ç›‘æµ‹æ–¹æ³•å¤šä¾èµ–äººå·¥å·¡æŸ¥ï¼Œæ•ˆç‡ä½ä¸‹ä¸”å®¹æ˜“å—åˆ°äººä¸ºå› ç´ çš„å½±å“ï¼Œæ— æ³•æ»¡è¶³ç°ä»£åŸå¸‚ç®¡ç†çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œå¼€å‘ä¸€ç§é«˜æ•ˆã€è‡ªåŠ¨åŒ–çš„äº•ç›–å¼€é—­çŠ¶æ€åˆ†ç±»ä¸å›¾åƒåˆ†å‰²ç³»ç»Ÿæ˜¾å¾—å°¤ä¸ºå¿…è¦ã€‚

è¿‘å¹´æ¥ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è¿…çŒ›å‘å±•ä¸ºå›¾åƒå¤„ç†é¢†åŸŸå¸¦æ¥äº†æ–°çš„æœºé‡ï¼Œå°¤å…¶æ˜¯åœ¨ç›®æ ‡æ£€æµ‹ä¸å›¾åƒåˆ†å‰²æ–¹é¢ã€‚YOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—æ¨¡å‹å› å…¶é«˜æ•ˆçš„å®æ—¶æ€§å’Œå‡†ç¡®æ€§ï¼Œå·²æˆä¸ºç›®æ ‡æ£€æµ‹é¢†åŸŸçš„çƒ­é—¨é€‰æ‹©ã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„æ€§èƒ½å’Œåº”ç”¨èŒƒå›´ã€‚ç„¶è€Œï¼Œé’ˆå¯¹äº•ç›–å¼€é—­çŠ¶æ€çš„å…·ä½“åº”ç”¨ï¼Œç°æœ‰çš„YOLOv8æ¨¡å‹ä»å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚ç¯å¢ƒä¸‹çš„å›¾åƒåˆ†å‰²ç²¾åº¦å’Œåˆ†ç±»å‡†ç¡®æ€§æ–¹é¢ã€‚å› æ­¤ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„äº•ç›–å¼€é—­çŠ¶æ€åˆ†ç±»å›¾åƒåˆ†å‰²ç³»ç»Ÿçš„ç ”ç©¶å…·æœ‰é‡è¦çš„ç°å®æ„ä¹‰ã€‚

æœ¬ç ”ç©¶æ‰€ä½¿ç”¨çš„æ•°æ®é›†åŒ…å«8600å¼ å›¾åƒï¼Œæ¶µç›–äº†äº•ç›–çš„ä¸‰ç§çŠ¶æ€ï¼šå…³é—­ã€æ‰“å¼€å’Œç‰©ä½“é®æŒ¡ã€‚è¿™ä¸€ä¸°å¯Œçš„æ•°æ®é›†ä¸ºæ¨¡å‹çš„è®­ç»ƒä¸éªŒè¯æä¾›äº†åšå®çš„åŸºç¡€ã€‚é€šè¿‡å¯¹ä¸åŒçŠ¶æ€ä¸‹äº•ç›–å›¾åƒçš„æ·±å…¥åˆ†æï¼Œå¯ä»¥æœ‰æ•ˆæå‡æ¨¡å‹å¯¹äº•ç›–çŠ¶æ€çš„è¯†åˆ«èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†ä¸­ç‰©ä½“é®æŒ¡çš„ç±»åˆ«ä¹Ÿä¸ºæ¨¡å‹çš„é²æ£’æ€§æä¾›äº†æŒ‘æˆ˜ï¼Œè¿›ä¸€æ­¥æ¨åŠ¨äº†å›¾åƒåˆ†å‰²æŠ€æœ¯çš„å‘å±•ã€‚ç ”ç©¶è¡¨æ˜ï¼Œé’ˆå¯¹ç‰¹å®šåº”ç”¨åœºæ™¯è¿›è¡Œæ¨¡å‹çš„æ”¹è¿›ä¸ä¼˜åŒ–ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ç›®æ ‡æ£€æµ‹ä¸åˆ†å‰²çš„ç²¾åº¦ã€‚

æœ¬ç ”ç©¶çš„æ„ä¹‰ä¸ä»…åœ¨äºæŠ€æœ¯å±‚é¢çš„åˆ›æ–°ï¼Œæ›´åœ¨äºå…¶å¯¹åŸå¸‚ç®¡ç†çš„å®é™…åº”ç”¨ä»·å€¼ã€‚é€šè¿‡å®ç°äº•ç›–å¼€é—­çŠ¶æ€çš„è‡ªåŠ¨åŒ–ç›‘æµ‹ï¼Œå¯ä»¥æœ‰æ•ˆé™ä½äººå·¥å·¡æŸ¥çš„æˆæœ¬ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘å› äº•ç›–çŠ¶æ€ä¸å½“å¼•å‘çš„å®‰å…¨äº‹æ•…ã€‚åŒæ—¶ï¼Œè¯¥ç³»ç»Ÿçš„æ¨å¹¿åº”ç”¨å°†ä¸ºåŸå¸‚æ™ºèƒ½ç®¡ç†æä¾›æœ‰åŠ›æ”¯æŒï¼Œæ¨åŠ¨æ™ºæ…§åŸå¸‚çš„å»ºè®¾è¿›ç¨‹ã€‚æ­¤å¤–ï¼Œç ”ç©¶æˆæœè¿˜å¯ä»¥ä¸ºå…¶ä»–ç±»ä¼¼çš„åŸºç¡€è®¾æ–½ç›‘æµ‹æä¾›å€Ÿé‰´ï¼Œå…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„äº•ç›–å¼€é—­çŠ¶æ€åˆ†ç±»å›¾åƒåˆ†å‰²ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„å­¦æœ¯ä»·å€¼ï¼Œæ›´å…·å¤‡æ˜¾è‘—çš„ç¤¾ä¼šæ„ä¹‰ã€‚é€šè¿‡æŠ€æœ¯åˆ›æ–°ä¸å®é™…åº”ç”¨çš„ç»“åˆï¼Œèƒ½å¤Ÿä¸ºåŸå¸‚åŸºç¡€è®¾æ–½çš„æ™ºèƒ½åŒ–ç®¡ç†æä¾›æœ‰æ•ˆè§£å†³æ–¹æ¡ˆï¼Œæ¨åŠ¨åŸå¸‚å¯æŒç»­å‘å±•ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

æ³¨æ„ï¼šæœ¬é¡¹ç›®æä¾›å®Œæ•´çš„è®­ç»ƒæºç æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,ç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æŒ‰ç…§6.è®­ç»ƒæ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°ä¸Šå›¾æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV19HmeYkEpF/)

### 4.æ•°æ®é›†ä¿¡æ¯

##### 4.1 æ•°æ®é›†ç±»åˆ«æ•°ï¼†ç±»åˆ«å

nc: 2
names: ['close_hatch', 'open_hatch']


##### 4.2 æ•°æ®é›†ä¿¡æ¯ç®€ä»‹

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨æœ¬ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åä¸ºâ€œhatchâ€çš„æ•°æ®é›†ï¼Œä»¥æ”¯æŒå¯¹äº•ç›–å¼€é—­çŠ¶æ€çš„åˆ†ç±»å’Œå›¾åƒåˆ†å‰²ä»»åŠ¡ã€‚è¯¥æ•°æ®é›†ä¸“é—¨è®¾è®¡ç”¨äºè®­ç»ƒå’Œè¯„ä¼°æ”¹è¿›ç‰ˆYOLOv8-segæ¨¡å‹ï¼Œæ—¨åœ¨æé«˜äº•ç›–çŠ¶æ€è¯†åˆ«çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚æ•°æ®é›†çš„ç±»åˆ«æ•°é‡ä¸º2ï¼Œåˆ†åˆ«ä¸ºâ€œclose_hatchâ€å’Œâ€œopen_hatchâ€ï¼Œè¿™ä¸¤ä¸ªç±»åˆ«ä»£è¡¨äº†äº•ç›–çš„ä¸¤ç§åŸºæœ¬çŠ¶æ€ï¼šå…³é—­å’Œæ‰“å¼€ã€‚

â€œhatchâ€æ•°æ®é›†çš„æ„å»ºè€ƒè™‘åˆ°äº†å®é™…åº”ç”¨ä¸­çš„å¤šæ ·æ€§å’Œå¤æ‚æ€§ã€‚æ¯ä¸ªç±»åˆ«çš„å›¾åƒå‡æ¶µç›–äº†ä¸åŒçš„ç¯å¢ƒã€å…‰ç…§æ¡ä»¶å’Œæ‹æ‘„è§’åº¦ï¼Œä»¥ç¡®ä¿æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­å…·æœ‰è‰¯å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚å…³é—­çŠ¶æ€çš„äº•ç›–å›¾åƒå¯èƒ½ä¼šå‘ˆç°å‡ºä¸åŒçš„æè´¨ã€é¢œè‰²å’Œæ±¡å¢ç¨‹åº¦ï¼Œè€Œæ‰“å¼€çŠ¶æ€çš„äº•ç›–åˆ™å¯èƒ½å±•ç¤ºå‡ºä¸åŒçš„å†…éƒ¨ç»“æ„å’Œå‘¨å›´ç¯å¢ƒã€‚è¿™ç§å¤šæ ·æ€§ä¸ä»…å¢å¼ºäº†æ•°æ®é›†çš„ä»£è¡¨æ€§ï¼Œä¹Ÿä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†ä¸°å¯Œçš„æ ·æœ¬ï¼Œç¡®ä¿å…¶èƒ½å¤Ÿé€‚åº”å„ç§å®é™…åœºæ™¯ã€‚

åœ¨æ•°æ®é›†çš„æ ‡æ³¨è¿‡ç¨‹ä¸­ï¼Œé‡‡ç”¨äº†ç²¾ç¡®çš„å›¾åƒåˆ†å‰²æŠ€æœ¯ï¼Œä¸ºæ¯ä¸ªç±»åˆ«çš„å›¾åƒæä¾›äº†é«˜è´¨é‡çš„æ©è†œã€‚è¿™äº›æ©è†œæ ‡æ³¨äº†äº•ç›–çš„è½®å»“ï¼Œä½¿å¾—æ¨¡å‹åœ¨è¿›è¡Œå›¾åƒåˆ†å‰²æ—¶èƒ½å¤Ÿå‡†ç¡®åœ°è¯†åˆ«å’Œåˆ†ç¦»äº•ç›–ä¸èƒŒæ™¯çš„å…³ç³»ã€‚è¿™ç§ç²¾ç»†çš„æ ‡æ³¨æ–¹å¼å¯¹äºè®­ç»ƒYOLOv8-segæ¨¡å‹è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒç›´æ¥å½±å“åˆ°æ¨¡å‹çš„å­¦ä¹ æ•ˆæœå’Œæœ€ç»ˆçš„åˆ†å‰²ç²¾åº¦ã€‚

æ­¤å¤–ï¼Œæ•°æ®é›†è¿˜è€ƒè™‘åˆ°äº†ä¸åŒåœºæ™¯ä¸‹äº•ç›–çš„èƒŒæ™¯å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œäº•ç›–å¯èƒ½ä½äºåŸå¸‚è¡—é“ã€ä¹¡æ‘å°é“æˆ–å·¥ä¸šåŒºç­‰ä¸åŒç¯å¢ƒä¸­ã€‚æ¯ç§ç¯å¢ƒçš„èƒŒæ™¯ç‰¹å¾éƒ½æœ‰æ‰€ä¸åŒï¼Œè¿™è¦æ±‚æ¨¡å‹ä¸ä»…è¦è¯†åˆ«äº•ç›–çš„çŠ¶æ€ï¼Œè¿˜è¦èƒ½å¤Ÿé€‚åº”å„ç§å¤æ‚çš„èƒŒæ™¯ä¿¡æ¯ã€‚è¿™ç§èƒŒæ™¯å¤šæ ·æ€§æœ‰åŠ©äºæé«˜æ¨¡å‹åœ¨çœŸå®ä¸–ç•Œåº”ç”¨ä¸­çš„é²æ£’æ€§ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä¿æŒé«˜æ•ˆçš„è¯†åˆ«èƒ½åŠ›ã€‚

ä¸ºäº†ç¡®ä¿æ•°æ®é›†çš„è´¨é‡å’Œæœ‰æ•ˆæ€§ï¼Œæˆ‘ä»¬åœ¨æ•°æ®æ”¶é›†å’Œæ ‡æ³¨è¿‡ç¨‹ä¸­é‡‡å–äº†ä¸¥æ ¼çš„æ ‡å‡†ã€‚æ‰€æœ‰å›¾åƒå‡ç»è¿‡ä¸“ä¸šäººå‘˜çš„å®¡æ ¸ï¼Œç¡®ä¿æ¯ä¸ªæ ‡æ³¨çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚è¿™ç§é«˜æ ‡å‡†çš„è´¨é‡æ§åˆ¶ä¸ä»…æå‡äº†æ•°æ®é›†çš„å¯ä¿¡åº¦ï¼Œä¹Ÿä¸ºåç»­çš„æ¨¡å‹è®­ç»ƒå’Œè¯„ä¼°å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†â€œhatchâ€æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œä»¥ä¾¿äºå¯¹æ¨¡å‹çš„æ€§èƒ½è¿›è¡Œè¯„ä¼°å’Œè°ƒä¼˜ã€‚é€šè¿‡å¯¹æ¨¡å‹åœ¨ä¸åŒæ•°æ®é›†ä¸Šçš„è¡¨ç°è¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£æ¨¡å‹çš„å­¦ä¹ æ•ˆæœï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œå‚æ•°è°ƒæ•´å’Œä¼˜åŒ–ã€‚

æ€»ä¹‹ï¼Œâ€œhatchâ€æ•°æ®é›†ä¸ºæ”¹è¿›YOLOv8-segçš„äº•ç›–å¼€é—­çŠ¶æ€åˆ†ç±»å›¾åƒåˆ†å‰²ç³»ç»Ÿæä¾›äº†ä¸°å¯Œçš„è®­ç»ƒèµ„æºå’Œé«˜è´¨é‡çš„æ ‡æ³¨ä¿¡æ¯ã€‚é€šè¿‡å……åˆ†åˆ©ç”¨è¿™ä¸€æ•°æ®é›†ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿæ˜¾è‘—æå‡äº•ç›–çŠ¶æ€è¯†åˆ«çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ï¼Œä¸ºåŸå¸‚åŸºç¡€è®¾æ–½çš„ç®¡ç†å’Œç»´æŠ¤æä¾›æœ‰åŠ›çš„æŠ€æœ¯æ”¯æŒã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.é¡¹ç›®ä¾èµ–ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.bilibili.com/video/BV1jG4Ve4E9t/?vd_source=bc9aec86d164b67a7004b996143742dc)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.bilibili.com/video/BV1nA4VeYEze/?vd_source=bc9aec86d164b67a7004b996143742dc)

### 6.æ‰‹æŠŠæ‰‹YOLOV8-segè®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8-segè®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.bilibili.com/video/BV1cA4VeYETe/?vd_source=bc9aec86d164b67a7004b996143742dc)


æŒ‰ç…§ä¸Šé¢çš„è®­ç»ƒè§†é¢‘æ•™ç¨‹é“¾æ¥åŠ è½½é¡¹ç›®æä¾›çš„æ•°æ®é›†ï¼Œè¿è¡Œtrain.pyå³å¯å¼€å§‹è®­ç»ƒ
ï»¿


     Epoch   gpu_mem       box       obj       cls    labels  img_size
     1/200     0G   0.01576   0.01955  0.007536        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:42<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:14<00:00,  2.87it/s]
                 all       3395      17314      0.994      0.957      0.0957      0.0843

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     2/200     0G   0.01578   0.01923  0.007006        22      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [14:44<00:00,  1.04s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 213/213 [01:12<00:00,  2.95it/s]
                 all       3395      17314      0.996      0.956      0.0957      0.0845

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     3/200     0G   0.01561    0.0191  0.006895        27      1280: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 849/849 [10:56<00:00,  1.29it/s]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 187/213 [00:52<00:00,  4.04it/s]
                 all       3395      17314      0.996      0.957      0.0957      0.0845




### 7.50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹åŠ è½½è°ƒå‚å®éªŒè§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹åŠ è½½è°ƒå‚å®éªŒè§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.bilibili.com/video/BV1Hw4VePEXv/?vd_source=bc9aec86d164b67a7004b996143742dc)

### YOLOV8-segç®—æ³•ç®€ä»‹

åŸå§‹YOLOv8-segç®—æ³•åŸç†

YOLOv8-segç®—æ³•æ˜¯ç”±Ultralyticså…¬å¸äº2023å¹´æ¨å‡ºçš„YOLOç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ ‡å¿—ç€ç›®æ ‡æ£€æµ‹å’Œå®ä¾‹åˆ†å‰²é¢†åŸŸçš„åˆä¸€æ¬¡é‡å¤§è¿›æ­¥ã€‚YOLOv8ä¸ä»…åœ¨é€Ÿåº¦å’Œç²¾åº¦ä¸Šè¶…è¶Šäº†å‰ä»£æ¨¡å‹ï¼Œè¿˜å¼•å…¥äº†ä¸€ç³»åˆ—åˆ›æ–°çš„æŠ€æœ¯å’Œç»“æ„è®¾è®¡ï¼Œä½¿å…¶åœ¨å„ç§è®¡ç®—å¹³å°ä¸Šéƒ½èƒ½é«˜æ•ˆè¿è¡Œã€‚YOLOv8-segç‰¹åˆ«é’ˆå¯¹å›¾åƒåˆ†å‰²ä»»åŠ¡è¿›è¡Œäº†ä¼˜åŒ–ï¼Œç»“åˆäº†YOLOv8çš„å¼ºå¤§ç‰¹æ€§ï¼Œå½¢æˆäº†ä¸€ç§é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚

YOLOv8-segçš„æ ¸å¿ƒåœ¨äºå…¶ç‹¬ç‰¹çš„ç½‘ç»œç»“æ„ï¼ŒåŒ…æ‹¬Backboneã€Neckå’ŒHeadä¸‰ä¸ªä¸»è¦éƒ¨åˆ†ã€‚Backboneè´Ÿè´£ç‰¹å¾æå–ï¼Œé‡‡ç”¨äº†CSPï¼ˆCross Stage Partialï¼‰ç»“æ„ï¼Œæ—¨åœ¨é€šè¿‡åˆ†ç¦»ç‰¹å¾æå–è¿‡ç¨‹æ¥å¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚å…·ä½“è€Œè¨€ï¼ŒYOLOv8-segä½¿ç”¨äº†C2fæ¨¡å—æ¥æ›¿ä»£YOLOv5ä¸­çš„C3æ¨¡å—ï¼Œè¿™ä¸€å˜åŒ–æ˜¾è‘—æå‡äº†ç‰¹å¾æå–çš„æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚C2fæ¨¡å—é€šè¿‡å¢åŠ è·³å±‚è¿æ¥å’ŒSplitæ“ä½œï¼Œå¢å¼ºäº†ä¿¡æ¯æµåŠ¨ï¼Œä¿ƒè¿›äº†ç‰¹å¾çš„å¤šæ ·æ€§å’Œä¸°å¯Œæ€§ã€‚

åœ¨ç‰¹å¾èåˆæ–¹é¢ï¼ŒYOLOv8-segé‡‡ç”¨äº†PAN-FPNï¼ˆPath Aggregation Network - Feature Pyramid Networkï¼‰ç»“æ„ã€‚è¿™ä¸€ç»“æ„é€šè¿‡å¤šå°ºåº¦ç‰¹å¾èåˆï¼Œèƒ½å¤Ÿæœ‰æ•ˆæ•´åˆæ¥è‡ªä¸åŒå±‚æ¬¡çš„ç‰¹å¾ä¿¡æ¯ï¼Œä»è€Œæé«˜æ¨¡å‹å¯¹å¤æ‚åœºæ™¯çš„ç†è§£èƒ½åŠ›ã€‚PAN-FPNä¸ä»…æå‡äº†ç‰¹å¾çš„è¡¨è¾¾èƒ½åŠ›ï¼Œè¿˜å¢å¼ºäº†æ¨¡å‹åœ¨å°ç›®æ ‡æ£€æµ‹å’Œé«˜åˆ†è¾¨ç‡å›¾åƒå¤„ç†ä¸­çš„è¡¨ç°ï¼Œå°¤å…¶åœ¨å¤„ç†å¤æ‚èƒŒæ™¯æ—¶ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°åˆ†ç¦»ç›®æ ‡ä¸èƒŒæ™¯ã€‚

YOLOv8-segçš„æ£€æµ‹ç½‘ç»œé‡‡ç”¨äº†Anchor-Freeçš„æ£€æµ‹æ–¹å¼ï¼Œè¿™ä¸€åˆ›æ–°ä½¿å¾—æ¨¡å‹åœ¨å¤„ç†ä¸åŒå°ºåº¦çš„ç›®æ ‡æ—¶æ›´åŠ çµæ´»ã€‚ä¼ ç»Ÿçš„Anchor-Basedæ–¹æ³•å¾€å¾€éœ€è¦æ‰‹åŠ¨è®¾ç½®é”šæ¡†ï¼Œè€ŒYOLOv8-segé€šè¿‡è§£è€¦å¤´ç»“æ„ï¼Œæ¶ˆé™¤äº†å¯¹é”šæ¡†çš„ä¾èµ–ã€‚è¿™ç§è®¾è®¡ä¸ä»…ç®€åŒ–äº†æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ï¼Œè¿˜æé«˜äº†æ£€æµ‹çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚è§£è€¦å¤´ç»“æ„å°†åˆ†ç±»å’Œå›å½’ä»»åŠ¡åˆ†å¼€å¤„ç†ï¼Œä½¿å¾—æ¨¡å‹åœ¨è¿›è¡Œç›®æ ‡åˆ†ç±»å’Œä½ç½®å›å½’æ—¶èƒ½å¤Ÿæ›´ä¸“æ³¨äºå„è‡ªçš„ä»»åŠ¡ï¼Œä»è€Œæå‡äº†æ•´ä½“æ€§èƒ½ã€‚

åœ¨æŸå¤±å‡½æ•°æ–¹é¢ï¼ŒYOLOv8-segå¼•å…¥äº†CloUæŸå¤±å‡½æ•°ï¼Œè¿™ä¸€æŸå¤±å‡½æ•°åœ¨ç›®æ ‡æ£€æµ‹å’Œå®ä¾‹åˆ†å‰²ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ã€‚CloUæŸå¤±å‡½æ•°é€šè¿‡è€ƒè™‘ç›®æ ‡çš„å½¢çŠ¶å’Œä½ç½®ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æŒ‡å¯¼æ¨¡å‹å­¦ä¹ ï¼Œæé«˜äº†åˆ†å‰²ç²¾åº¦ã€‚ä¸ä¼ ç»Ÿçš„æŸå¤±å‡½æ•°ç›¸æ¯”ï¼ŒCloUæŸå¤±å‡½æ•°æ›´èƒ½é€‚åº”å¤æ‚åœºæ™¯ä¸‹çš„ç›®æ ‡å˜åŒ–ï¼Œä½¿å¾—YOLOv8-segåœ¨å¤„ç†å„ç§æ•°æ®é›†æ—¶éƒ½èƒ½ä¿æŒè¾ƒé«˜çš„å‡†ç¡®æ€§ã€‚

YOLOv8-segçš„æ¨¡å‹è®¾ç½®ä¹Ÿç›¸å½“çµæ´»ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å…·ä½“ä»»åŠ¡éœ€æ±‚è°ƒæ•´æ¨¡å‹çš„æ·±åº¦å’Œå®½åº¦ã€‚é€šè¿‡è°ƒæ•´depth_factorå’Œwidth_factorå‚æ•°ï¼Œç”¨æˆ·å¯ä»¥è½»æ¾åœ°æ”¹å˜æ¨¡å‹çš„è§„æ¨¡ï¼Œä»è€Œåœ¨ä¸åŒçš„ç¡¬ä»¶å¹³å°ä¸Šå®ç°æœ€ä½³æ€§èƒ½ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—YOLOv8-segä¸ä»…é€‚ç”¨äºé«˜æ€§èƒ½çš„GPUæœåŠ¡å™¨ï¼Œä¹Ÿèƒ½åœ¨èµ„æºæœ‰é™çš„è®¾å¤‡ä¸Šè¿è¡Œï¼Œå±•ç°å‡ºè‰¯å¥½çš„é€‚åº”æ€§ã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒYOLOv8-segé€šè¿‡å¼•å…¥å¤šç§æ•°æ®å¢å¼ºæŠ€æœ¯ï¼Œè¿›ä¸€æ­¥æå‡äº†æ¨¡å‹çš„é²æ£’æ€§ã€‚æ•°æ®å¢å¼ºä¸ä»…å¯ä»¥å¢åŠ è®­ç»ƒæ ·æœ¬çš„å¤šæ ·æ€§ï¼Œè¿˜èƒ½æœ‰æ•ˆé˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼Œä»è€Œæé«˜æ¨¡å‹åœ¨çœŸå®åœºæ™¯ä¸­çš„æ³›åŒ–èƒ½åŠ›ã€‚ç»“åˆYOLOv8-segçš„é«˜æ•ˆç»“æ„å’Œå…ˆè¿›çš„è®­ç»ƒç­–ç•¥ï¼Œä½¿å¾—è¯¥æ¨¡å‹åœ¨å„ç±»æ•°æ®é›†ä¸Šå‡è¡¨ç°å‡ºè‰²ï¼Œå°¤å…¶æ˜¯åœ¨COCOå’ŒPascal VOCç­‰æ ‡å‡†æ•°æ®é›†ä¸Šï¼ŒYOLOv8-segçš„mAPï¼ˆmean Average Precisionï¼‰æŒ‡æ ‡å‡æ˜¾è‘—ä¼˜äºå‰ä»£æ¨¡å‹ã€‚

æ­¤å¤–ï¼ŒYOLOv8-segè¿˜åŸç”Ÿæ”¯æŒè‡ªå®šä¹‰æ•°æ®é›†çš„è®­ç»ƒï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚ï¼Œè½»æ¾åœ°å°†ç‰¹å®šé¢†åŸŸçš„æ•°æ®é›†å¼•å…¥æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚è¿™ä¸€ç‰¹æ€§æå¤§åœ°æ‰©å±•äº†YOLOv8-segçš„åº”ç”¨èŒƒå›´ï¼Œä½¿å…¶èƒ½å¤Ÿå¹¿æ³›åº”ç”¨äºåŒ»ç–—å½±åƒåˆ†æã€è‡ªåŠ¨é©¾é©¶ã€æ™ºèƒ½ç›‘æ§ç­‰å¤šä¸ªé¢†åŸŸã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8-segç®—æ³•é€šè¿‡å¼•å…¥ä¸€ç³»åˆ—åˆ›æ–°çš„è®¾è®¡å’ŒæŠ€æœ¯ï¼Œæå¤§åœ°æå‡äº†ç›®æ ‡æ£€æµ‹å’Œå®ä¾‹åˆ†å‰²çš„æ€§èƒ½ã€‚å…¶ç‹¬ç‰¹çš„ç½‘ç»œç»“æ„ã€çµæ´»çš„æ¨¡å‹è®¾ç½®ã€å…ˆè¿›çš„æŸå¤±å‡½æ•°ä»¥åŠå¼ºå¤§çš„æ•°æ®å¢å¼ºèƒ½åŠ›ï¼Œä½¿å¾—YOLOv8-segåœ¨å½“å‰è®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­å æ®äº†é‡è¦çš„åœ°ä½ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼ŒYOLOv8-segæ— ç–‘å°†ä¸ºæ›´å¤šçš„å®é™…åº”ç”¨åœºæ™¯æä¾›é«˜æ•ˆã€å‡†ç¡®çš„è§£å†³æ–¹æ¡ˆï¼Œæ¨åŠ¨ç›®æ ‡æ£€æµ‹å’Œå®ä¾‹åˆ†å‰²æŠ€æœ¯çš„è¿›ä¸€æ­¥å‘å±•ã€‚

![18.png](18.png)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV11ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

#### 10.1 ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[10.1 50+ç§å…¨å¥—YOLOV8-segåˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

#### 10.2 éƒ¨åˆ†æ”¹è¿›æ¨¡å—åŸç†è®²è§£(å®Œæ•´çš„æ”¹è¿›åŸç†è§ä¸Šå›¾å’ŒæŠ€æœ¯åšå®¢é“¾æ¥)ã€å¦‚æœæ­¤å°èŠ‚çš„å›¾åŠ è½½å¤±è´¥å¯ä»¥é€šè¿‡CSDNæˆ–è€…Githubæœç´¢è¯¥åšå®¢çš„æ ‡é¢˜è®¿é—®åŸå§‹åšå®¢ï¼ŒåŸå§‹åšå®¢å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸ã€‘
ï»¿### å…¨ç»´åŠ¨æ€å·ç§¯ODConv
é‰´äºä¸Šè¿°è®¨è®ºï¼Œæˆ‘ä»¬çš„ODConvå¼•å…¥äº†ä¸€ç§å¤šç»´æ³¨æ„æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…·æœ‰å¹¶è¡Œç­–ç•¥ï¼Œç”¨äºå­¦ä¹ å·ç§¯æ ¸åœ¨æ ¸ç©ºé—´çš„æ‰€æœ‰å››ä¸ªç»´åº¦ä¸Šçš„ä¸åŒæ³¨æ„ã€‚å›¾æä¾›äº†CondConvã€DyConvå’ŒODConvçš„ç¤ºæ„æ€§æ¯”è¾ƒã€‚

ODConvçš„å…¬å¼ï¼šæ ¹æ®ç­‰å¼1ä¸­çš„ç¬¦å·ï¼ŒODConvå¯å®šä¹‰ä¸º

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/c4c8a9680805404b8f65dc3e40246389.png)



 å°†æ³¨æ„åŠ›æ ‡é‡åˆ†é…ç»™æ•´ä¸ªå·ç§¯æ ¸ã€‚å›¾2ç¤ºå‡ºäº†å°†è¿™å››ç§ç±»å‹çš„å…³æ³¨ä¹˜ä»¥nä¸ªå·ç§¯æ ¸çš„è¿‡ç¨‹ã€‚åŸåˆ™ä¸Šï¼Œè¿™å››ç§ç±»å‹çš„å…³æ³¨æ˜¯ç›¸äº’è¡¥å……çš„ï¼Œå¹¶ä¸”ä»¥ä½ç½®ã€ä¿¡é“ã€æ»¤æ³¢å™¨å’Œæ ¸çš„é¡ºåºå°†å®ƒä»¬é€æ­¥ä¹˜ä»¥å·ç§¯æ ¸ 
 ï¼Œä½¿å¾—å·ç§¯è¿ç®—ä¸åŒw.r.t.æ‰€æœ‰ç©ºé—´ä½ç½®ã€æ‰€æœ‰è¾“å…¥ä¿¡é“ã€æ‰€æœ‰æ»¤æ³¢å™¨å’Œè¾“å…¥xçš„æ‰€æœ‰æ ¸ï¼Œæä¾›æ•è·ä¸°å¯Œä¸Šä¸‹æ–‡çº¿ç´¢çš„æ€§èƒ½ä¿è¯ã€‚å› æ­¤ï¼ŒODConvå¯ä»¥æ˜¾è‘—å¢å¼ºCNNåŸºæœ¬å·ç§¯è¿ç®—çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œå…·æœ‰å•ä¸ªå·ç§¯æ ¸çš„ODConvå¯ä»¥ä¸æ ‡å‡†CondConvå’ŒDyConvç«äº‰æˆ–ä¼˜äºå®ƒä»¬ï¼Œä¸ºæœ€ç»ˆæ¨¡å‹å¼•å…¥çš„é¢å¤–å‚æ•°å¤§å¤§å‡å°‘ã€‚æä¾›äº†å¤§é‡å®éªŒæ¥éªŒè¯è¿™äº›ä¼˜ç‚¹ã€‚é€šè¿‡æ¯”è¾ƒç­‰å¼1å’Œç­‰å¼2ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼ŒODConvæ˜¯ä¸€ç§æ›´å¹¿ä¹‰çš„åŠ¨æ€å·ç§¯ã€‚æ­¤å¤–ï¼Œå½“è®¾ç½®n=1ä¸” æ‰€æœ‰åˆ†é‡å‡ä¸º1æ—¶ï¼Œåªå…³æ³¨æ»¤æ³¢å™¨æ–¹å‘ çš„ODConvå°†å‡å°‘ä¸ºï¼šå°†åŸºäºè¾“å…¥ç‰¹å¾çš„SEå˜é‡åº”ç”¨äºå·ç§¯æ»¤æ³¢å™¨ï¼Œç„¶åè¿›è¡Œå·ç§¯è¿ç®—ï¼ˆæ³¨æ„åŸå§‹SEï¼ˆHuç­‰äººï¼Œ2018bï¼‰åŸºäºè¾“å‡ºç‰¹å¾ï¼Œå¹¶ä¸”ç”¨äºé‡æ–°æ ¡å‡†è¾“å‡ºç‰¹å¾æœ¬èº«ï¼‰ã€‚è¿™ç§SEå˜ä½“æ˜¯ODConvçš„ç‰¹ä¾‹ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/dace8513a2e54c5f8daf7cffdacf0683.png)

å›¾ï¼šå°†ODConvä¸­çš„å››ç§æ³¨æ„ç±»å‹é€æ­¥ä¹˜ä»¥å·ç§¯æ ¸çš„ç¤ºä¾‹ã€‚ï¼ˆaï¼‰ æ²¿ç©ºé—´ç»´åº¦çš„é€ä½ç½®ä¹˜æ³•è¿ç®—ï¼Œï¼ˆbï¼‰æ²¿è¾“å…¥ä¿¡é“ç»´åº¦çš„é€ä¿¡é“ä¹˜æ³•è¿ç®—ã€ï¼ˆcï¼‰æ²¿è¾“å‡ºä¿¡é“ç»´åº¦çš„æŒ‰æ»¤æ³¢å™¨ä¹˜æ³•è¿ç®—ï¼Œä»¥åŠï¼ˆdï¼‰æ²¿å·ç§¯æ ¸ç©ºé—´çš„æ ¸ç»´åº¦çš„æŒ‰æ ¸ä¹˜æ³•è¿ç®—ã€‚æ–¹æ³•éƒ¨åˆ†å¯¹ç¬¦å·è¿›è¡Œäº†è¯´æ˜
å®ç°ï¼šå¯¹äºODConvï¼Œä¸€ä¸ªå…³é”®é—®é¢˜æ˜¯å¦‚ä½•è®¡ç®—å·ç§¯æ ¸çš„å››ç§å…³æ³¨åº¦ ã€‚ç»§CondConvå’ŒDyConvä¹‹åï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨SEå‹æ³¨æ„åŠ›æ¨¡å—ï¼ˆHuç­‰äººï¼Œ2018bï¼‰ï¼Œä½†å°†å¤šä¸ªå¤´éƒ¨ä½œä¸ºæ¥è®¡ç®—å®ƒä»¬ï¼Œå…¶ç»“æ„å¦‚å›¾æ‰€ç¤ºã€‚å…·ä½“è€Œè¨€ï¼Œé¦–å…ˆé€šè¿‡é€é€šé“å…¨å±€å¹³å‡æ± ï¼ˆGAPï¼‰è¿ç®—å°†è¾“å…¥å‹ç¼©åˆ°å…·æœ‰é•¿åº¦çš„ç‰¹å¾å‘é‡ä¸­ã€‚éšåï¼Œå­˜åœ¨å®Œå…¨è¿æ¥ï¼ˆFCï¼‰å±‚å’Œå››ä¸ªå¤´éƒ¨åˆ†æ”¯ã€‚ReLUï¼ˆKrizhevskyç­‰äººï¼Œ2012ï¼‰ä½äºFCå±‚ä¹‹åã€‚FCå±‚å°†å‹ç¼©ç‰¹å¾å‘é‡æ˜ å°„åˆ°å…·æœ‰ç¼©å‡æ¯”çš„ä½ç»´ç©ºé—´ï¼ˆæ ¹æ®æ¶ˆèå®éªŒï¼Œæˆ‘ä»¬åœ¨æ‰€æœ‰ä¸»è¦å®éªŒä¸­è®¾ç½® ï¼Œé¿å…äº†é«˜æ¨¡å‹å¤æ‚åº¦ï¼‰ã€‚å¯¹äºå››ä¸ªå¤´éƒ¨åˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯éƒ½æœ‰ä¸€ä¸ªè¾“å‡ºå¤§å°å¦‚å›¾ã€‚
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/direct/ffccc84c8e1140809f864ff8701cf76e.png)
### å¼•å…¥ODConvçš„æ”¹è¿›YOLO
å‚è€ƒè¿™ç¯‡åšå®¢æ¶µç›–äº†å¼•å…¥ODConvçš„æ”¹è¿›YOLOv8ç³»ç»Ÿçš„å†…å®¹ï¼ŒODConvé‡‡ç”¨å¤šç»´æ³¨æ„æœºåˆ¶ï¼Œåœ¨å·ç§¯æ ¸ç©ºé—´çš„å››ä¸ªç»´åº¦ä¸Šå­¦ä¹ ä¸åŒçš„æ³¨æ„ã€‚ç»“åˆäº†CondConvå’ŒDyConvçš„ä¼˜åŠ¿ï¼ŒODConvé€šè¿‡å›¾ç¤ºçš„å››ç§æ³¨æ„ç±»å‹é€æ­¥ä¸å·ç§¯æ ¸ç›¸ä¹˜ï¼Œä»¥æ•è·ä¸°å¯Œçš„ä¸Šä¸‹æ–‡çº¿ç´¢ï¼Œæå‡ç‰¹å¾æå–èƒ½åŠ›ã€‚

#### ODConvç»“æ„ä¸æ–¹æ³•
ODConvçš„å…¬å¼å’Œå›¾ç¤ºå±•ç¤ºäº†å…¶å…³æ³¨åŠ›åˆ†é…ç»™å·ç§¯æ ¸çš„æ–¹å¼ï¼Œå…¶ä¸­å››ç§ç±»å‹çš„å…³æ³¨ä»¥ä½ç½®ã€ä¿¡é“ã€æ»¤æ³¢å™¨å’Œæ ¸çš„é¡ºåºé€æ­¥ä¸å·ç§¯æ ¸ç›¸ä¹˜ã€‚è¿™ç§ç»“æ„ä¿è¯äº†å·ç§¯è¿ç®—ä¸åŒäºæ ‡å‡†çš„Convæ“ä½œï¼Œèƒ½å¤Ÿæ•è·æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œå¢å¼ºäº†CNNçš„ç‰¹å¾æå–èƒ½åŠ›ã€‚å¦å¤–ï¼Œå•ä¸ªå·ç§¯æ ¸çš„ODConvåœ¨æ€§èƒ½ä¸Šèƒ½å¤Ÿä¸CondConvå’ŒDyConvç›¸ç«äº‰ï¼Œå¹¶ä¸”å¼•å…¥çš„é¢å¤–å‚æ•°å¤§å¹…å‡å°‘ã€‚

ODConvçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå…¶å¹¿ä¹‰çš„åŠ¨æ€å·ç§¯æ€§è´¨ï¼ŒåŒæ—¶åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼ˆn=1ä¸”æ‰€æœ‰åˆ†é‡ä¸º1ï¼‰ï¼Œå®ƒå¯ä»¥é€€åŒ–ä¸ºä¸€ç§ç‰¹ä¾‹ï¼Œå³åªå…³æ³¨æ»¤æ³¢å™¨æ–¹å‘ï¼Œè¿™ç±»ä¼¼äºåŸºäºè¾“å…¥ç‰¹å¾çš„SEå˜ä½“ï¼Œä½†ä¸åŒäºåŸå§‹SEï¼Œå®ƒåŸºäºè¾“å‡ºç‰¹å¾ã€‚

#### ODConvçš„å®ç°
å…³é”®é—®é¢˜åœ¨äºå¦‚ä½•è®¡ç®—å·ç§¯æ ¸çš„å››ç§å…³æ³¨åº¦ã€‚ODConvé‡‡ç”¨äº†SEå‹æ³¨æ„åŠ›æ¨¡å—ï¼Œç»“åˆäº†å¤šä¸ªå¤´éƒ¨æ¥è®¡ç®—è¿™äº›å…³æ³¨åº¦ã€‚å…·ä½“å®ç°ä¸Šï¼Œé€šè¿‡é€é€šé“å…¨å±€å¹³å‡æ± è¿ç®—å’Œå®Œå…¨è¿æ¥å±‚ï¼Œå°†è¾“å…¥å‹ç¼©ä¸ºç‰¹å¾å‘é‡ï¼Œéšåä½¿ç”¨å››ä¸ªå¤´éƒ¨åˆ†æ”¯æ¥è®¡ç®—å››ç§ä¸åŒç±»å‹çš„å…³æ³¨ã€‚è¿™æ ·çš„ç»“æ„èƒ½åœ¨ä¿æŒæ¨¡å‹å¤æ‚åº¦å¯æ§çš„æƒ…å†µä¸‹ï¼Œæå‡äº†ç‰¹å¾çš„è¡¨å¾èƒ½åŠ›ã€‚

ODConvçš„å¼•å…¥ä¸ºYOLOv8å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼Œå¹¶ä¸”é€šè¿‡å¤§é‡å®éªŒè¯æ˜äº†å…¶åœ¨ç‰¹å¾æå–æ–¹é¢çš„ä¼˜è¶Šæ€§ã€‚å…¶ç»“åˆäº†å¤šç»´æ³¨æ„æœºåˆ¶å’Œå·ç§¯æ“ä½œï¼Œä¸ºç›®æ ‡æ£€æµ‹å’Œåˆ†æ‹£ç³»ç»Ÿçš„æå‡å¸¦æ¥äº†æ–°çš„æ€è·¯å’Œæ€§èƒ½çªç ´ã€‚


### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 ultralytics\engine\results.py

ä»¥ä¸‹æ˜¯å¯¹ä»£ç ä¸­æœ€æ ¸å¿ƒéƒ¨åˆ†çš„æç‚¼å’Œè¯¦ç»†ä¸­æ–‡æ³¨é‡Šï¼š

```python
class BaseTensor(SimpleClass):
    """åŸºç¡€å¼ é‡ç±»ï¼Œæä¾›æ–¹ä¾¿çš„æ“ä½œå’Œè®¾å¤‡å¤„ç†æ–¹æ³•ã€‚"""

    def __init__(self, data, orig_shape) -> None:
        """
        åˆå§‹åŒ– BaseTensorï¼ŒåŒ…å«æ•°æ®å’ŒåŸå§‹å½¢çŠ¶ã€‚

        å‚æ•°:
            data (torch.Tensor | np.ndarray): é¢„æµ‹ç»“æœï¼Œä¾‹å¦‚è¾¹ç•Œæ¡†ã€æ©ç å’Œå…³é”®ç‚¹ã€‚
            orig_shape (tuple): å›¾åƒçš„åŸå§‹å½¢çŠ¶ã€‚
        """
        assert isinstance(data, (torch.Tensor, np.ndarray))  # ç¡®ä¿æ•°æ®æ˜¯å¼ é‡æˆ–æ•°ç»„
        self.data = data  # å­˜å‚¨æ•°æ®
        self.orig_shape = orig_shape  # å­˜å‚¨åŸå§‹å½¢çŠ¶

    @property
    def shape(self):
        """è¿”å›æ•°æ®å¼ é‡çš„å½¢çŠ¶ã€‚"""
        return self.data.shape

    def cpu(self):
        """è¿”å›ä¸€ä¸ªåœ¨CPUå†…å­˜ä¸Šçš„å¼ é‡å‰¯æœ¬ã€‚"""
        return self if isinstance(self.data, np.ndarray) else self.__class__(self.data.cpu(), self.orig_shape)

    def numpy(self):
        """è¿”å›ä¸€ä¸ªä½œä¸ºnumpyæ•°ç»„çš„å¼ é‡å‰¯æœ¬ã€‚"""
        return self if isinstance(self.data, np.ndarray) else self.__class__(self.data.numpy(), self.orig_shape)

    def cuda(self):
        """è¿”å›ä¸€ä¸ªåœ¨GPUå†…å­˜ä¸Šçš„å¼ é‡å‰¯æœ¬ã€‚"""
        return self.__class__(torch.as_tensor(self.data).cuda(), self.orig_shape)

    def to(self, *args, **kwargs):
        """è¿”å›ä¸€ä¸ªåœ¨æŒ‡å®šè®¾å¤‡å’Œæ•°æ®ç±»å‹ä¸Šçš„å¼ é‡å‰¯æœ¬ã€‚"""
        return self.__class__(torch.as_tensor(self.data).to(*args, **kwargs), self.orig_shape)

    def __len__(self):  # é‡å†™len(results)
        """è¿”å›æ•°æ®å¼ é‡çš„é•¿åº¦ã€‚"""
        return len(self.data)

    def __getitem__(self, idx):
        """è¿”å›æŒ‡å®šç´¢å¼•çš„æ•°æ®å¼ é‡å‰¯æœ¬ã€‚"""
        return self.__class__(self.data[idx], self.orig_shape)


class Results(SimpleClass):
    """
    å­˜å‚¨å’Œæ“ä½œæ¨ç†ç»“æœçš„ç±»ã€‚

    å‚æ•°:
        orig_img (numpy.ndarray): åŸå§‹å›¾åƒçš„numpyæ•°ç»„ã€‚
        path (str): å›¾åƒæ–‡ä»¶çš„è·¯å¾„ã€‚
        names (dict): ç±»åˆ«åç§°çš„å­—å…¸ã€‚
        boxes (torch.tensor, optional): æ¯ä¸ªæ£€æµ‹çš„è¾¹ç•Œæ¡†åæ ‡çš„2Då¼ é‡ã€‚
        masks (torch.tensor, optional): æ£€æµ‹æ©ç çš„3Då¼ é‡ï¼Œæ¯ä¸ªæ©ç æ˜¯ä¸€ä¸ªäºŒå€¼å›¾åƒã€‚
        probs (torch.tensor, optional): æ¯ä¸ªç±»åˆ«çš„æ¦‚ç‡çš„1Då¼ é‡ã€‚
        keypoints (List[List[float]], optional): æ¯ä¸ªå¯¹è±¡çš„æ£€æµ‹å…³é”®ç‚¹åˆ—è¡¨ã€‚
    """

    def __init__(self, orig_img, path, names, boxes=None, masks=None, probs=None, keypoints=None) -> None:
        """åˆå§‹åŒ– Results ç±»ã€‚"""
        self.orig_img = orig_img  # å­˜å‚¨åŸå§‹å›¾åƒ
        self.orig_shape = orig_img.shape[:2]  # å­˜å‚¨åŸå§‹å›¾åƒçš„å½¢çŠ¶
        self.boxes = Boxes(boxes, self.orig_shape) if boxes is not None else None  # å­˜å‚¨è¾¹ç•Œæ¡†
        self.masks = Masks(masks, self.orig_shape) if masks is not None else None  # å­˜å‚¨æ©ç 
        self.probs = Probs(probs) if probs is not None else None  # å­˜å‚¨æ¦‚ç‡
        self.keypoints = Keypoints(keypoints, self.orig_shape) if keypoints is not None else None  # å­˜å‚¨å…³é”®ç‚¹
        self.names = names  # å­˜å‚¨ç±»åˆ«åç§°
        self.path = path  # å­˜å‚¨å›¾åƒè·¯å¾„

    def update(self, boxes=None, masks=None, probs=None):
        """æ›´æ–° Results å¯¹è±¡çš„è¾¹ç•Œæ¡†ã€æ©ç å’Œæ¦‚ç‡å±æ€§ã€‚"""
        if boxes is not None:
            ops.clip_boxes(boxes, self.orig_shape)  # è£å‰ªè¾¹ç•Œæ¡†
            self.boxes = Boxes(boxes, self.orig_shape)
        if masks is not None:
            self.masks = Masks(masks, self.orig_shape)
        if probs is not None:
            self.probs = probs

    def plot(self, conf=True, boxes=True, masks=True, probs=True):
        """
        åœ¨è¾“å…¥çš„RGBå›¾åƒä¸Šç»˜åˆ¶æ£€æµ‹ç»“æœã€‚

        å‚æ•°:
            conf (bool): æ˜¯å¦ç»˜åˆ¶æ£€æµ‹ç½®ä¿¡åº¦åˆ†æ•°ã€‚
            boxes (bool): æ˜¯å¦ç»˜åˆ¶è¾¹ç•Œæ¡†ã€‚
            masks (bool): æ˜¯å¦ç»˜åˆ¶æ©ç ã€‚
            probs (bool): æ˜¯å¦ç»˜åˆ¶åˆ†ç±»æ¦‚ç‡ã€‚

        è¿”å›:
            (numpy.ndarray): å¸¦æ³¨é‡Šçš„å›¾åƒçš„numpyæ•°ç»„ã€‚
        """
        # çœç•¥å…¶ä»–å‚æ•°å¤„ç†...

        # ç»˜åˆ¶è¾¹ç•Œæ¡†
        if self.boxes and boxes:
            for d in reversed(self.boxes):
                # ç»˜åˆ¶æ¯ä¸ªè¾¹ç•Œæ¡†
                annotator.box_label(d.xyxy.squeeze(), label, color=colors(c, True))

        # ç»˜åˆ¶æ©ç 
        if self.masks and masks:
            annotator.masks(self.masks.data, colors=[colors(x, True) for x in idx], im_gpu=im_gpu)

        return annotator.result()  # è¿”å›ç»˜åˆ¶åçš„å›¾åƒ

    def save_txt(self, txt_file, save_conf=False):
        """
        å°†é¢„æµ‹ç»“æœä¿å­˜åˆ°txtæ–‡ä»¶ã€‚

        å‚æ•°:
            txt_file (str): txtæ–‡ä»¶è·¯å¾„ã€‚
            save_conf (bool): æ˜¯å¦ä¿å­˜ç½®ä¿¡åº¦åˆ†æ•°ã€‚
        """
        # çœç•¥æ–‡æœ¬ä¿å­˜é€»è¾‘...

class Boxes(BaseTensor):
    """
    å­˜å‚¨å’Œæ“ä½œæ£€æµ‹è¾¹ç•Œæ¡†çš„ç±»ã€‚

    å‚æ•°:
        boxes (torch.Tensor | numpy.ndarray): åŒ…å«æ£€æµ‹è¾¹ç•Œæ¡†çš„å¼ é‡æˆ–æ•°ç»„ã€‚
        orig_shape (tuple): åŸå§‹å›¾åƒå¤§å°ï¼Œæ ¼å¼ä¸º (é«˜åº¦, å®½åº¦)ã€‚
    """

    def __init__(self, boxes, orig_shape) -> None:
        """åˆå§‹åŒ– Boxes ç±»ã€‚"""
        if boxes.ndim == 1:
            boxes = boxes[None, :]  # å¦‚æœæ˜¯ä¸€ç»´ï¼Œè½¬ä¸ºäºŒç»´
        super().__init__(boxes, orig_shape)  # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°

    @property
    def xyxy(self):
        """è¿”å›è¾¹ç•Œæ¡†çš„xyxyæ ¼å¼ã€‚"""
        return self.data[:, :4]

    @property
    def conf(self):
        """è¿”å›è¾¹ç•Œæ¡†çš„ç½®ä¿¡åº¦å€¼ã€‚"""
        return self.data[:, -2]

    @property
    def cls(self):
        """è¿”å›è¾¹ç•Œæ¡†çš„ç±»åˆ«å€¼ã€‚"""
        return self.data[:, -1]

class Masks(BaseTensor):
    """
    å­˜å‚¨å’Œæ“ä½œæ£€æµ‹æ©ç çš„ç±»ã€‚
    """

    def __init__(self, masks, orig_shape) -> None:
        """åˆå§‹åŒ– Masks ç±»ã€‚"""
        if masks.ndim == 2:
            masks = masks[None, :]  # å¦‚æœæ˜¯ä¸€ç»´ï¼Œè½¬ä¸ºäºŒç»´
        super().__init__(masks, orig_shape)  # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°

class Keypoints(BaseTensor):
    """
    å­˜å‚¨å’Œæ“ä½œæ£€æµ‹å…³é”®ç‚¹çš„ç±»ã€‚
    """

    def __init__(self, keypoints, orig_shape) -> None:
        """åˆå§‹åŒ– Keypoints ç±»ã€‚"""
        if keypoints.ndim == 2:
            keypoints = keypoints[None, :]  # å¦‚æœæ˜¯ä¸€ç»´ï¼Œè½¬ä¸ºäºŒç»´
        super().__init__(keypoints, orig_shape)  # è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°
```

### ä»£ç åˆ†æ
1. **BaseTensor**: è¿™æ˜¯ä¸€ä¸ªåŸºç¡€ç±»ï¼Œå°è£…äº†å¯¹å¼ é‡çš„åŸºæœ¬æ“ä½œï¼ŒåŒ…æ‹¬è®¾å¤‡ç®¡ç†ï¼ˆCPU/GPUï¼‰å’Œæ•°æ®æ ¼å¼è½¬æ¢ï¼ˆnumpyæ•°ç»„ï¼‰ã€‚
2. **Results**: è¯¥ç±»ç”¨äºå­˜å‚¨æ¨ç†ç»“æœï¼ŒåŒ…æ‹¬åŸå§‹å›¾åƒã€è¾¹ç•Œæ¡†ã€æ©ç ã€æ¦‚ç‡å’Œå…³é”®ç‚¹ã€‚å®ƒæä¾›äº†æ›´æ–°å’Œç»˜åˆ¶ç»“æœçš„æ–¹æ³•ã€‚
3. **Boxes, Masks, Keypoints**: è¿™äº›ç±»ç»§æ‰¿è‡ªBaseTensorï¼Œåˆ†åˆ«ç”¨äºå¤„ç†æ£€æµ‹åˆ°çš„è¾¹ç•Œæ¡†ã€æ©ç å’Œå…³é”®ç‚¹ï¼Œæä¾›äº†ç‰¹å®šçš„å±æ€§å’Œæ–¹æ³•ä»¥ä¾¿äºæ•°æ®çš„è®¿é—®å’Œæ“ä½œã€‚

é€šè¿‡è¿™äº›æ ¸å¿ƒç±»çš„è®¾è®¡ï¼Œä»£ç å®ç°äº†å¯¹YOLOæ¨¡å‹æ¨ç†ç»“æœçš„é«˜æ•ˆç®¡ç†å’Œå¯è§†åŒ–ã€‚

è¿™ä¸ªæ–‡ä»¶æ˜¯Ultralytics YOLOæ¨¡å‹çš„ç»“æœå¤„ç†æ¨¡å—ï¼Œä¸»è¦ç”¨äºå¤„ç†æ¨ç†ç»“æœï¼ŒåŒ…æ‹¬æ£€æµ‹æ¡†ã€æ©è†œã€å…³é”®ç‚¹å’Œåˆ†ç±»æ¦‚ç‡ç­‰ã€‚æ–‡ä»¶ä¸­å®šä¹‰äº†å¤šä¸ªç±»ï¼Œåˆ†åˆ«ç”¨äºä¸åŒç±»å‹çš„æ•°æ®å¤„ç†ï¼Œå…·ä½“åŒ…æ‹¬BaseTensorã€Resultsã€Boxesã€Masksã€Keypointså’ŒProbsç­‰ã€‚

BaseTensorç±»æ˜¯ä¸€ä¸ªåŸºç¡€ç±»ï¼Œæä¾›äº†ä¸€äº›æ–¹ä¾¿çš„æ–¹æ³•æ¥å¤„ç†å¼ é‡æ•°æ®ï¼ŒåŒ…æ‹¬åœ¨CPUå’ŒGPUä¹‹é—´çš„è½¬æ¢ã€è¿”å›numpyæ•°ç»„ç­‰ã€‚å®ƒçš„æ„é€ å‡½æ•°æ¥æ”¶æ•°æ®å’ŒåŸå§‹å›¾åƒçš„å½¢çŠ¶ï¼Œå¹¶æä¾›äº†ä¸€äº›å±æ€§å’Œæ–¹æ³•æ¥è®¿é—®å’Œæ“ä½œè¿™äº›æ•°æ®ã€‚

Resultsç±»ç”¨äºå­˜å‚¨å’Œæ“ä½œæ¨ç†ç»“æœã€‚å®ƒåŒ…å«äº†åŸå§‹å›¾åƒã€è·¯å¾„ã€ç±»åˆ«åç§°ã€æ£€æµ‹æ¡†ã€æ©è†œã€æ¦‚ç‡å’Œå…³é”®ç‚¹ç­‰ä¿¡æ¯ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®å’Œæ›´æ–°æ£€æµ‹ç»“æœï¼Œå¹¶å¯ä»¥å°†ç»“æœå¯è§†åŒ–ã€ä¿å­˜åˆ°æ–‡ä»¶ç­‰ã€‚è¯¥ç±»æä¾›äº†è®¸å¤šæ–¹æ³•ï¼Œä¾‹å¦‚æ›´æ–°æ£€æµ‹æ¡†å’Œæ©è†œã€å°†ç»“æœè½¬æ¢ä¸ºä¸åŒæ ¼å¼ã€ç»˜åˆ¶ç»“æœå›¾åƒã€ä¿å­˜æ–‡æœ¬æ–‡ä»¶ç­‰ã€‚

Boxesç±»ç”¨äºå¤„ç†æ£€æµ‹æ¡†æ•°æ®ï¼Œæä¾›äº†å¯¹æ£€æµ‹æ¡†çš„å„ç§æ“ä½œï¼ŒåŒ…æ‹¬è·å–æ¡†çš„åæ ‡ã€ç½®ä¿¡åº¦ã€ç±»åˆ«ç­‰ä¿¡æ¯ã€‚å®ƒç»§æ‰¿è‡ªBaseTensorï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šæ·»åŠ äº†ç‰¹å®šäºæ£€æµ‹æ¡†çš„åŠŸèƒ½ã€‚

Masksç±»ç”¨äºå¤„ç†æ£€æµ‹æ©è†œï¼Œæä¾›äº†è·å–æ©è†œçš„åƒç´ åæ ‡å’Œå½’ä¸€åŒ–åæ ‡çš„æ–¹æ³•ã€‚å®ƒåŒæ ·ç»§æ‰¿è‡ªBaseTensorï¼Œæ‰©å±•äº†åŸºç¡€å¼ é‡çš„åŠŸèƒ½ä»¥é€‚åº”æ©è†œæ•°æ®çš„å¤„ç†ã€‚

Keypointsç±»ç”¨äºå¤„ç†å…³é”®ç‚¹æ•°æ®ï¼Œæä¾›äº†è·å–å…³é”®ç‚¹åæ ‡å’Œç½®ä¿¡åº¦çš„æ–¹æ³•ã€‚å®ƒåœ¨åˆå§‹åŒ–æ—¶ä¼šæ£€æŸ¥å…³é”®ç‚¹çš„å¯è§æ€§ï¼Œå¹¶åœ¨å¿…è¦æ—¶å°†ä¸å¯è§çš„å…³é”®ç‚¹åæ ‡ç½®ä¸ºé›¶ã€‚

Probsç±»ç”¨äºå¤„ç†åˆ†ç±»æ¦‚ç‡ï¼Œæä¾›äº†è·å–æœ€é«˜ç½®ä¿¡åº¦ç±»åˆ«åŠå…¶ç½®ä¿¡åº¦çš„æ–¹æ³•ã€‚å®ƒä¹Ÿç»§æ‰¿è‡ªBaseTensorï¼Œä¸“æ³¨äºåˆ†ç±»ä»»åŠ¡çš„ç»“æœå¤„ç†ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸ºYOLOæ¨¡å‹çš„æ¨ç†ç»“æœæä¾›äº†ä¸€ä¸ªç»“æ„åŒ–çš„å¤„ç†æ–¹å¼ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°è·å–å’Œæ“ä½œå„ç§æ£€æµ‹ç»“æœï¼Œå¹¶è¿›è¡Œå¯è§†åŒ–å’Œä¿å­˜ç­‰æ“ä½œã€‚

#### 11.2 ultralytics\utils\callbacks\__init__.py

```python
# å¯¼å…¥Ultralytics YOLO ğŸš€ï¼Œéµå¾ªAGPL-3.0è®¸å¯è¯

# ä»å½“å‰åŒ…çš„baseæ¨¡å—ä¸­å¯¼å…¥ä¸‰ä¸ªå‡½æ•°
from .base import add_integration_callbacks, default_callbacks, get_default_callbacks

# å®šä¹‰æ¨¡å—çš„å…¬å¼€æ¥å£ï¼ŒæŒ‡å®šå¯ä»¥è¢«å¤–éƒ¨è®¿é—®çš„å‡½æ•°
__all__ = 'add_integration_callbacks', 'default_callbacks', 'get_default_callbacks'
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼šä»£ç ä¸­é€šè¿‡ç›¸å¯¹å¯¼å…¥çš„æ–¹å¼ï¼Œä»`base`æ¨¡å—ä¸­å¼•å…¥äº†ä¸‰ä¸ªå‡½æ•°ã€‚è¿™äº›å‡½æ•°å¯èƒ½ç”¨äºé›†æˆå›è°ƒã€è·å–é»˜è®¤å›è°ƒç­‰åŠŸèƒ½ã€‚
   
2. **å…¬å¼€æ¥å£**ï¼š`__all__`å˜é‡å®šä¹‰äº†æ¨¡å—çš„å…¬å…±æ¥å£ï¼Œåªæœ‰åœ¨ä½¿ç”¨`from module import *`æ—¶ï¼Œåˆ—å‡ºçš„å‡½æ•°æ‰ä¼šè¢«å¯¼å…¥ã€‚è¿™æ˜¯ä¸€ç§æ§åˆ¶æ¨¡å—å¯¼å‡ºå†…å®¹çš„æ–¹å¼ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å¯ä»¥ä½¿ç”¨å“ªäº›åŠŸèƒ½ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOé¡¹ç›®ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸»è¦ç”¨äºå›è°ƒå‡½æ•°çš„ç®¡ç†å’Œé›†æˆã€‚æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ç‰ˆæƒå£°æ˜ï¼Œè¡¨æ˜è¯¥ä»£ç éµå¾ªAGPL-3.0è®¸å¯è¯ã€‚æ¥ä¸‹æ¥çš„å‡ è¡Œä»£ç å¯¼å…¥äº†å…¶ä»–æ¨¡å—ä¸­çš„ç‰¹å®šå‡½æ•°ï¼Œè¿™äº›å‡½æ•°åˆ†åˆ«æ˜¯`add_integration_callbacks`ã€`default_callbacks`å’Œ`get_default_callbacks`ï¼Œå®ƒä»¬æ¥è‡ªäºåŒä¸€ç›®å½•ä¸‹çš„`base`æ¨¡å—ã€‚

è¿™äº›å¯¼å…¥çš„å‡½æ•°å¯èƒ½ç”¨äºè®¾ç½®å’Œç®¡ç†æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­çš„å›è°ƒæœºåˆ¶ï¼Œå›è°ƒå‡½æ•°é€šå¸¸æ˜¯åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨äºç›‘æ§è®­ç»ƒè¿›åº¦ã€ä¿å­˜æ¨¡å‹ã€è°ƒæ•´å­¦ä¹ ç‡ç­‰æ“ä½œã€‚æœ€åï¼Œ`__all__`å˜é‡å®šä¹‰äº†æ¨¡å—çš„å…¬å…±æ¥å£ï¼Œè¡¨æ˜å½“ä½¿ç”¨`from module import *`è¯­å¥æ—¶ï¼Œåªæœ‰è¿™ä¸‰ä¸ªå‡½æ•°ä¼šè¢«å¯¼å…¥ã€‚è¿™ç§åšæ³•æœ‰åŠ©äºæ§åˆ¶æ¨¡å—çš„å¯è§æ€§å’Œé¿å…å‘½åå†²çªã€‚

#### 11.3 ultralytics\nn\backbone\fasternet.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import torch.nn as nn
from typing import List
from torch import Tensor

class Partial_conv3(nn.Module):
    """
    éƒ¨åˆ†å·ç§¯å±‚ï¼Œç”¨äºåœ¨è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ä¸­å¤„ç†è¾“å…¥ç‰¹å¾å›¾ã€‚
    """

    def __init__(self, dim, n_div, forward):
        super().__init__()
        self.dim_conv3 = dim // n_div  # éƒ¨åˆ†å·ç§¯çš„é€šé“æ•°
        self.dim_untouched = dim - self.dim_conv3  # æœªè¢«å·ç§¯å¤„ç†çš„é€šé“æ•°
        self.partial_conv3 = nn.Conv2d(self.dim_conv3, self.dim_conv3, 3, 1, 1, bias=False)  # å®šä¹‰å·ç§¯å±‚

        # æ ¹æ®forwardç±»å‹é€‰æ‹©å‰å‘ä¼ æ’­æ–¹å¼
        if forward == 'slicing':
            self.forward = self.forward_slicing
        elif forward == 'split_cat':
            self.forward = self.forward_split_cat
        else:
            raise NotImplementedError

    def forward_slicing(self, x: Tensor) -> Tensor:
        # ä»…ç”¨äºæ¨ç†
        x = x.clone()  # ä¿æŒåŸå§‹è¾“å…¥ä¸å˜ï¼Œä»¥ä¾¿åç»­çš„æ®‹å·®è¿æ¥
        x[:, :self.dim_conv3, :, :] = self.partial_conv3(x[:, :self.dim_conv3, :, :])  # è¿›è¡Œéƒ¨åˆ†å·ç§¯
        return x

    def forward_split_cat(self, x: Tensor) -> Tensor:
        # ç”¨äºè®­ç»ƒå’Œæ¨ç†
        x1, x2 = torch.split(x, [self.dim_conv3, self.dim_untouched], dim=1)  # å°†è¾“å…¥åˆ†ä¸ºä¸¤éƒ¨åˆ†
        x1 = self.partial_conv3(x1)  # å¯¹ç¬¬ä¸€éƒ¨åˆ†è¿›è¡Œå·ç§¯
        x = torch.cat((x1, x2), 1)  # å°†å·ç§¯åçš„éƒ¨åˆ†ä¸æœªå¤„ç†éƒ¨åˆ†æ‹¼æ¥
        return x


class MLPBlock(nn.Module):
    """
    å¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰å—ï¼ŒåŒ…å«å·ç§¯å±‚ã€å½’ä¸€åŒ–å±‚å’Œæ¿€æ´»å‡½æ•°ã€‚
    """

    def __init__(self, dim, n_div, mlp_ratio, drop_path, layer_scale_init_value, act_layer, norm_layer, pconv_fw_type):
        super().__init__()
        self.dim = dim
        self.mlp_ratio = mlp_ratio
        self.drop_path = nn.Identity() if drop_path <= 0 else DropPath(drop_path)  # éšæœºæ·±åº¦
        self.n_div = n_div

        mlp_hidden_dim = int(dim * mlp_ratio)  # MLPéšè—å±‚çš„ç»´åº¦

        # å®šä¹‰MLPå±‚
        mlp_layer: List[nn.Module] = [
            nn.Conv2d(dim, mlp_hidden_dim, 1, bias=False),
            norm_layer(mlp_hidden_dim),
            act_layer(),
            nn.Conv2d(mlp_hidden_dim, dim, 1, bias=False)
        ]
        self.mlp = nn.Sequential(*mlp_layer)  # å°†MLPå±‚ç»„åˆæˆä¸€ä¸ªåºåˆ—

        # åˆå§‹åŒ–éƒ¨åˆ†å·ç§¯
        self.spatial_mixing = Partial_conv3(dim, n_div, pconv_fw_type)

    def forward(self, x: Tensor) -> Tensor:
        shortcut = x  # ä¿å­˜è¾“å…¥ä»¥è¿›è¡Œæ®‹å·®è¿æ¥
        x = self.spatial_mixing(x)  # è¿›è¡Œç©ºé—´æ··åˆ
        x = shortcut + self.drop_path(self.mlp(x))  # æ®‹å·®è¿æ¥
        return x


class FasterNet(nn.Module):
    """
    FasterNetæ¨¡å‹ï¼ŒåŒ…å«å¤šä¸ªé˜¶æ®µå’Œä¸åŒçš„ç‰¹å¾æå–å±‚ã€‚
    """

    def __init__(self, in_chans=3, num_classes=1000, embed_dim=96, depths=(1, 2, 8, 2), mlp_ratio=2., n_div=4,
                 patch_size=4, patch_stride=4, patch_size2=2, patch_stride2=2, patch_norm=True, drop_path_rate=0.1,
                 layer_scale_init_value=0, norm_layer='BN', act_layer='RELU', pconv_fw_type='split_cat'):
        super().__init__()

        # é€‰æ‹©å½’ä¸€åŒ–å±‚å’Œæ¿€æ´»å‡½æ•°
        norm_layer = nn.BatchNorm2d if norm_layer == 'BN' else NotImplementedError
        act_layer = nn.GELU if act_layer == 'GELU' else partial(nn.ReLU, inplace=True)

        self.num_stages = len(depths)  # æ¨¡å‹é˜¶æ®µæ•°é‡
        self.embed_dim = embed_dim  # åµŒå…¥ç»´åº¦
        self.patch_embed = PatchEmbed(patch_size, patch_stride, in_chans, embed_dim, norm_layer if patch_norm else None)  # å›¾åƒåµŒå…¥

        # éšæœºæ·±åº¦è¡°å‡è§„åˆ™
        dpr = [x.item() for x in torch.linspace(0, drop_path_rate, sum(depths))]

        # æ„å»ºå„ä¸ªé˜¶æ®µ
        stages_list = []
        for i_stage in range(self.num_stages):
            stage = BasicStage(dim=int(embed_dim * 2 ** i_stage), n_div=n_div, depth=depths[i_stage],
                               mlp_ratio=mlp_ratio, drop_path=dpr[sum(depths[:i_stage]):sum(depths[:i_stage + 1])],
                               layer_scale_init_value=layer_scale_init_value, norm_layer=norm_layer,
                               act_layer=act_layer, pconv_fw_type=pconv_fw_type)
            stages_list.append(stage)

            # æ·»åŠ è¡¥ä¸åˆå¹¶å±‚
            if i_stage < self.num_stages - 1:
                stages_list.append(PatchMerging(patch_size2=patch_size2, patch_stride2=patch_stride2,
                                                 dim=int(embed_dim * 2 ** i_stage), norm_layer=norm_layer))

        self.stages = nn.Sequential(*stages_list)  # å°†æ‰€æœ‰é˜¶æ®µç»„åˆæˆä¸€ä¸ªåºåˆ—

    def forward(self, x: Tensor) -> Tensor:
        # è¾“å‡ºå››ä¸ªé˜¶æ®µçš„ç‰¹å¾ç”¨äºå¯†é›†é¢„æµ‹
        x = self.patch_embed(x)  # è¿›è¡Œå›¾åƒåµŒå…¥
        outs = []
        for idx, stage in enumerate(self.stages):
            x = stage(x)  # é€šè¿‡æ¯ä¸ªé˜¶æ®µ
            if idx in self.out_indices:  # å¦‚æœæ˜¯è¾“å‡ºå±‚
                norm_layer = getattr(self, f'norm{idx}')  # è·å–å¯¹åº”çš„å½’ä¸€åŒ–å±‚
                x_out = norm_layer(x)  # è¿›è¡Œå½’ä¸€åŒ–
                outs.append(x_out)  # ä¿å­˜è¾“å‡º
        return outs
```

### ä»£ç è¯´æ˜ï¼š
1. **Partial_conv3**: è¿™ä¸ªç±»å®ç°äº†éƒ¨åˆ†å·ç§¯ï¼Œå…è®¸åœ¨è¾“å…¥ç‰¹å¾å›¾çš„æŸäº›é€šé“ä¸Šåº”ç”¨å·ç§¯æ“ä½œï¼ŒåŒæ—¶ä¿ç•™å…¶ä»–é€šé“ä¸å˜ã€‚æ ¹æ®ä¸åŒçš„å‰å‘ä¼ æ’­æ–¹å¼ï¼ˆåˆ‡ç‰‡æˆ–æ‹¼æ¥ï¼‰ï¼Œé€‰æ‹©ä¸åŒçš„è®¡ç®—æ–¹å¼ã€‚

2. **MLPBlock**: è¿™ä¸ªç±»å®ç°äº†ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºå—ï¼ŒåŒ…å«äº†å·ç§¯å±‚ã€å½’ä¸€åŒ–å±‚å’Œæ¿€æ´»å‡½æ•°ï¼Œå¹¶é€šè¿‡æ®‹å·®è¿æ¥å°†è¾“å…¥ä¸è¾“å‡ºç»“åˆã€‚

3. **FasterNet**: è¿™æ˜¯æ•´ä¸ªæ¨¡å‹çš„æ ¸å¿ƒç±»ï¼ŒåŒ…å«å¤šä¸ªé˜¶æ®µçš„ç‰¹å¾æå–æ¨¡å—ã€‚å®ƒé¦–å…ˆå°†è¾“å…¥å›¾åƒåˆ’åˆ†ä¸ºè¡¥ä¸ï¼Œç„¶åé€šè¿‡å¤šä¸ªåŸºæœ¬é˜¶æ®µè¿›è¡Œå¤„ç†ï¼Œæœ€åè¾“å‡ºç‰¹å¾å›¾ã€‚æ¯ä¸ªé˜¶æ®µå¯ä»¥åŒ…å«å¤šä¸ªMLPå—å’Œè¡¥ä¸åˆå¹¶å±‚ã€‚

è¿™äº›æ ¸å¿ƒéƒ¨åˆ†æ„æˆäº†FasterNetæ¨¡å‹çš„åŸºç¡€ç»“æ„ï¼Œè´Ÿè´£ç‰¹å¾æå–å’Œå¤„ç†ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º `FasterNet` çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸»è¦ç”¨äºå›¾åƒå¤„ç†ä»»åŠ¡ã€‚è¯¥æ¨¡å‹æ˜¯åŸºäºå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ„å»ºçš„ï¼Œå…·æœ‰å¤šä¸ªæ¨¡å—å’ŒåŠŸèƒ½ï¼Œæ—¨åœ¨æé«˜è®¡ç®—æ•ˆç‡å’Œæ€§èƒ½ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ PyTorchã€YAML ä»¥åŠä¸€äº›æ·±åº¦å­¦ä¹ ç›¸å…³çš„æ¨¡å—ã€‚æ¥ç€ï¼Œå®šä¹‰äº†ä¸€äº›åŸºç¡€çš„ç»„ä»¶ç±»ï¼Œä¾‹å¦‚ `Partial_conv3`ã€`MLPBlock`ã€`BasicStage`ã€`PatchEmbed` å’Œ `PatchMerging`ã€‚è¿™äº›ç»„ä»¶æ˜¯æ„å»º `FasterNet` æ¨¡å‹çš„åŸºç¡€ã€‚

`Partial_conv3` ç±»å®ç°äº†ä¸€ç§éƒ¨åˆ†å·ç§¯æ“ä½œï¼Œæ”¯æŒä¸¤ç§å‰å‘ä¼ æ’­æ–¹å¼ï¼šåˆ‡ç‰‡ï¼ˆslicingï¼‰å’Œæ‹¼æ¥ï¼ˆsplit_catï¼‰ã€‚è¿™ç§è®¾è®¡ä½¿å¾—æ¨¡å‹åœ¨æ¨ç†å’Œè®­ç»ƒæ—¶èƒ½å¤Ÿçµæ´»å¤„ç†è¾“å…¥æ•°æ®ã€‚

`MLPBlock` ç±»åˆ™å®ç°äº†ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥æœºï¼ˆMLPï¼‰æ¨¡å—ï¼ŒåŒ…å«äº†å·ç§¯å±‚ã€å½’ä¸€åŒ–å±‚å’Œæ¿€æ´»å‡½æ•°ã€‚è¯¥æ¨¡å—é€šè¿‡ `DropPath` æŠ€æœ¯å®ç°éšæœºæ·±åº¦ä¸¢å¼ƒï¼Œä»¥å¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚

`BasicStage` ç±»æ˜¯ç”±å¤šä¸ª `MLPBlock` ç»„æˆçš„ä¸€ä¸ªé˜¶æ®µï¼Œè´Ÿè´£å¤„ç†è¾“å…¥ç‰¹å¾å¹¶ä¼ é€’åˆ°ä¸‹ä¸€é˜¶æ®µã€‚`PatchEmbed` å’Œ `PatchMerging` ç±»åˆ†åˆ«ç”¨äºå°†è¾“å…¥å›¾åƒåˆ†å‰²æˆå°å—ï¼ˆpatchï¼‰å¹¶è¿›è¡Œç‰¹å¾èåˆï¼Œå¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚

`FasterNet` ç±»æ˜¯æ•´ä¸ªæ¨¡å‹çš„æ ¸å¿ƒï¼Œæ„é€ äº†å¤šä¸ªé˜¶æ®µå¹¶å®šä¹‰äº†è¾“å…¥è¾“å‡ºã€‚å®ƒæ¥æ”¶ä¸€äº›è¶…å‚æ•°ï¼Œå¦‚è¾“å…¥é€šé“æ•°ã€ç±»åˆ«æ•°ã€åµŒå…¥ç»´åº¦ã€æ·±åº¦ç­‰ï¼Œæ¥åˆå§‹åŒ–æ¨¡å‹ç»“æ„ã€‚æ¨¡å‹é€šè¿‡ `patch_embed` å°†è¾“å…¥å›¾åƒè½¬æ¢ä¸ºç‰¹å¾è¡¨ç¤ºï¼Œå¹¶é€šè¿‡å„ä¸ªé˜¶æ®µè¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆè¾“å‡ºç‰¹å¾ã€‚

æ­¤å¤–ï¼Œæ–‡ä»¶ä¸­è¿˜å®šä¹‰äº†ä¸€äº›å‡½æ•°ï¼Œå¦‚ `update_weight` ç”¨äºæ›´æ–°æ¨¡å‹æƒé‡ï¼Œ`fasternet_t0`ã€`fasternet_t1` ç­‰å‡½æ•°ç”¨äºåŠ è½½ä¸åŒé…ç½®çš„ `FasterNet` æ¨¡å‹ã€‚è¿™äº›å‡½æ•°ä¼šè¯»å– YAML é…ç½®æ–‡ä»¶ï¼Œæ„å»ºæ¨¡å‹å¹¶åŠ è½½é¢„è®­ç»ƒæƒé‡ï¼ˆå¦‚æœæä¾›ï¼‰ã€‚

æœ€åï¼Œåœ¨ `__main__` å—ä¸­ï¼Œç¤ºä¾‹ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `fasternet_t0` å‡½æ•°åŠ è½½æ¨¡å‹å¹¶è¿›è¡Œå‰å‘ä¼ æ’­ã€‚é€šè¿‡ç”Ÿæˆéšæœºè¾“å…¥ï¼Œæ‰“å°å‡ºæ¯ä¸ªé˜¶æ®µçš„è¾“å‡ºç‰¹å¾çš„å°ºå¯¸ï¼ŒéªŒè¯æ¨¡å‹çš„ç»“æ„å’ŒåŠŸèƒ½ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œé€‚ç”¨äºå„ç§å›¾åƒå¤„ç†ä»»åŠ¡ï¼Œå¹¶é€šè¿‡æ¨¡å—åŒ–è®¾è®¡æé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

#### 11.4 ultralytics\models\yolo\detect\train.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
class DetectionTrainer(BaseTrainer):
    """
    DetectionTrainerç±»ï¼Œç»§æ‰¿è‡ªBaseTrainerç±»ï¼Œç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒã€‚
    """

    def build_dataset(self, img_path, mode='train', batch=None):
        """
        æ„å»ºYOLOæ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ï¼Œ'train'è¡¨ç¤ºè®­ç»ƒæ¨¡å¼ï¼Œ'val'è¡¨ç¤ºéªŒè¯æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œä»…ç”¨äº'rect'æ¨¡å¼ã€‚é»˜è®¤ä¸ºNoneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)  # è·å–æ¨¡å‹çš„æœ€å¤§æ­¥å¹…
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == 'val', stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode='train'):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ['train', 'val']  # ç¡®ä¿æ¨¡å¼æœ‰æ•ˆ
        with torch_distributed_zero_first(rank):  # å¦‚æœä½¿ç”¨åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œï¼Œç¡®ä¿æ•°æ®é›†åªåˆå§‹åŒ–ä¸€æ¬¡
            dataset = self.build_dataset(dataset_path, mode, batch_size)  # æ„å»ºæ•°æ®é›†
        shuffle = mode == 'train'  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        if getattr(dataset, 'rect', False) and shuffle:
            LOGGER.warning("WARNING âš ï¸ 'rect=True'ä¸DataLoaderçš„shuffleä¸å…¼å®¹ï¼Œè®¾ç½®shuffle=False")
            shuffle = False  # å¦‚æœä½¿ç”¨'rect'æ¨¡å¼ï¼Œç¦ç”¨æ‰“ä¹±
        workers = self.args.workers if mode == 'train' else self.args.workers * 2  # è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹ä¸€æ‰¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch['img'] = batch['img'].to(self.device, non_blocking=True).float() / 255  # å°†å›¾åƒæ•°æ®è½¬ç§»åˆ°è®¾å¤‡å¹¶å½’ä¸€åŒ–
        return batch

    def set_model_attributes(self):
        """è®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ã€‚"""
        self.model.nc = self.data['nc']  # å°†ç±»åˆ«æ•°é‡é™„åŠ åˆ°æ¨¡å‹
        self.model.names = self.data['names']  # å°†ç±»åˆ«åç§°é™„åŠ åˆ°æ¨¡å‹
        self.model.args = self.args  # å°†è¶…å‚æ•°é™„åŠ åˆ°æ¨¡å‹

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data['nc'], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def get_validator(self):
        """è¿”å›ç”¨äºYOLOæ¨¡å‹éªŒè¯çš„DetectionValidatorã€‚"""
        self.loss_names = 'box_loss', 'cls_loss', 'dfl_loss'  # å®šä¹‰æŸå¤±åç§°
        return yolo.detect.DetectionValidator(self.test_loader, save_dir=self.save_dir, args=copy(self.args))  # è¿”å›éªŒè¯å™¨

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ³¨é‡Šã€‚"""
        plot_images(images=batch['img'],
                    batch_idx=batch['batch_idx'],
                    cls=batch['cls'].squeeze(-1),
                    bboxes=batch['bboxes'],
                    paths=batch['im_file'],
                    fname=self.save_dir / f'train_batch{ni}.jpg',
                    on_plot=self.on_plot)  # ä¿å­˜è®­ç»ƒæ ·æœ¬å›¾åƒ

    def plot_metrics(self):
        """ä»CSVæ–‡ä»¶ä¸­ç»˜åˆ¶æŒ‡æ ‡ã€‚"""
        plot_results(file=self.csv, on_plot=self.on_plot)  # ä¿å­˜ç»“æœå›¾åƒ
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **DetectionTrainerç±»**ï¼šè¯¥ç±»æ˜¯YOLOæ¨¡å‹è®­ç»ƒçš„æ ¸å¿ƒï¼Œç»§æ‰¿è‡ª`BaseTrainer`ï¼Œè´Ÿè´£æ„å»ºæ•°æ®é›†ã€åŠ è½½æ•°æ®ã€é¢„å¤„ç†ã€è®¾ç½®æ¨¡å‹å±æ€§ã€è·å–æ¨¡å‹å’ŒéªŒè¯å™¨ç­‰åŠŸèƒ½ã€‚
2. **build_datasetæ–¹æ³•**ï¼šç”¨äºæ„å»ºYOLOæ•°æ®é›†ï¼Œæ”¯æŒè®­ç»ƒå’ŒéªŒè¯æ¨¡å¼ã€‚
3. **get_dataloaderæ–¹æ³•**ï¼šæ„é€ æ•°æ®åŠ è½½å™¨ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­åªåˆå§‹åŒ–ä¸€æ¬¡æ•°æ®é›†ã€‚
4. **preprocess_batchæ–¹æ³•**ï¼šå¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼Œå°†å›¾åƒæ•°æ®å½’ä¸€åŒ–åˆ°[0, 1]èŒƒå›´ã€‚
5. **set_model_attributesæ–¹æ³•**ï¼šè®¾ç½®æ¨¡å‹çš„ç±»åˆ«æ•°é‡å’Œåç§°ï¼Œç¡®ä¿æ¨¡å‹èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«æ•°æ®é›†ä¸­çš„ç±»åˆ«ã€‚
6. **get_modelæ–¹æ³•**ï¼šè¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©æ€§åœ°åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
7. **get_validatoræ–¹æ³•**ï¼šè¿”å›ç”¨äºæ¨¡å‹éªŒè¯çš„éªŒè¯å™¨ï¼Œè®¡ç®—æŸå¤±ç­‰æŒ‡æ ‡ã€‚
8. **plot_training_sampleså’Œplot_metricsæ–¹æ³•**ï¼šç”¨äºå¯è§†åŒ–è®­ç»ƒæ ·æœ¬å’Œè®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯Ultralytics YOLOæ¨¡å‹çš„è®­ç»ƒæ¨¡å—ï¼Œä¸»è¦ç”¨äºç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªåä¸º`DetectionTrainer`çš„ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ª`BaseTrainer`ï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•æ¥æ„å»ºæ•°æ®é›†ã€åŠ è½½æ•°æ®ã€é¢„å¤„ç†å›¾åƒã€è®¾ç½®æ¨¡å‹å±æ€§ã€è·å–æ¨¡å‹ã€éªŒè¯æ¨¡å‹ã€è®°å½•æŸå¤±ã€æ˜¾ç¤ºè®­ç»ƒè¿›åº¦ä»¥åŠç»˜åˆ¶è®­ç»ƒæ ·æœ¬å’ŒæŒ‡æ ‡ã€‚

åœ¨æ–‡ä»¶å¼€å¤´ï¼Œå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬NumPyã€Ultralyticsçš„å„ç§å·¥å…·å’Œæ¨¡å‹ã€‚è¿™äº›å¯¼å…¥ä¸ºåç»­çš„è®­ç»ƒè¿‡ç¨‹æä¾›äº†åŸºç¡€åŠŸèƒ½ã€‚

`DetectionTrainer`ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¼ å…¥å‚æ•°æ¥åˆå§‹åŒ–è®­ç»ƒè¿‡ç¨‹ï¼Œä¾‹å¦‚æŒ‡å®šæ¨¡å‹æ–‡ä»¶ã€æ•°æ®é›†é…ç½®æ–‡ä»¶å’Œè®­ç»ƒè½®æ•°ã€‚ç±»ä¸­åŒ…å«çš„æ–¹æ³•ä¸»è¦åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼š

1. **æ„å»ºæ•°æ®é›†**ï¼š`build_dataset`æ–¹æ³•æ ¹æ®ä¼ å…¥çš„å›¾åƒè·¯å¾„å’Œæ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰æ„å»ºYOLOæ•°æ®é›†ã€‚è¯¥æ–¹æ³•è¿˜è€ƒè™‘äº†æ‰¹é‡å¤§å°å’Œå›¾åƒçš„æ­¥å¹…ï¼Œä»¥ç¡®ä¿æ•°æ®é›†é€‚åº”æ¨¡å‹çš„è¦æ±‚ã€‚

2. **è·å–æ•°æ®åŠ è½½å™¨**ï¼š`get_dataloader`æ–¹æ³•è´Ÿè´£åˆ›å»ºå¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚å®ƒä¼šæ ¹æ®è®­ç»ƒæˆ–éªŒè¯æ¨¡å¼è®¾ç½®æ˜¯å¦æ‰“ä¹±æ•°æ®ï¼Œå¹¶ä¸”åœ¨åˆ†å¸ƒå¼è®­ç»ƒä¸­ç¡®ä¿æ•°æ®é›†åªåˆå§‹åŒ–ä¸€æ¬¡ã€‚

3. **é¢„å¤„ç†æ‰¹æ¬¡**ï¼š`preprocess_batch`æ–¹æ³•å¯¹å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼Œå°†å›¾åƒæ•°æ®è½¬æ¢ä¸ºæµ®ç‚¹æ•°å¹¶å½’ä¸€åŒ–åˆ°0åˆ°1ä¹‹é—´ã€‚

4. **è®¾ç½®æ¨¡å‹å±æ€§**ï¼š`set_model_attributes`æ–¹æ³•å°†æ•°æ®é›†çš„ç±»åˆ«æ•°é‡å’Œåç§°ç­‰ä¿¡æ¯é™„åŠ åˆ°æ¨¡å‹ä¸Šï¼Œä»¥ä¾¿æ¨¡å‹èƒ½å¤Ÿæ­£ç¡®ç†è§£æ•°æ®ã€‚

5. **è·å–æ¨¡å‹**ï¼š`get_model`æ–¹æ³•è¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚

6. **è·å–éªŒè¯å™¨**ï¼š`get_validator`æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºæ¨¡å‹éªŒè¯çš„æ£€æµ‹éªŒè¯å™¨ï¼Œå¸®åŠ©ç›‘æ§è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ€§èƒ½ã€‚

7. **è®°å½•æŸå¤±**ï¼š`label_loss_items`æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ªåŒ…å«è®­ç»ƒæŸå¤±é¡¹çš„å­—å…¸ï¼Œä¾¿äºåç»­çš„åˆ†æå’Œç›‘æ§ã€‚

8. **è®­ç»ƒè¿›åº¦æ˜¾ç¤º**ï¼š`progress_string`æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºå½“å‰è®­ç»ƒçš„è¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰è½®æ¬¡ã€GPUå†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ç­‰ä¿¡æ¯ã€‚

9. **ç»˜åˆ¶è®­ç»ƒæ ·æœ¬**ï¼š`plot_training_samples`æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶å¯¹åº”çš„æ ‡æ³¨ï¼Œå¸®åŠ©å¯è§†åŒ–è®­ç»ƒæ•°æ®çš„è´¨é‡ã€‚

10. **ç»˜åˆ¶æŒ‡æ ‡**ï¼š`plot_metrics`æ–¹æ³•ä»CSVæ–‡ä»¶ä¸­è¯»å–è®­ç»ƒæŒ‡æ ‡å¹¶ç»˜åˆ¶ç»“æœï¼Œä¾¿äºåˆ†ææ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚

11. **ç»˜åˆ¶è®­ç»ƒæ ‡ç­¾**ï¼š`plot_training_labels`æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå¸¦æ ‡ç­¾çš„è®­ç»ƒå›¾ï¼Œå±•ç¤ºæ•°æ®é›†ä¸­æ‰€æœ‰çš„è¾¹ç•Œæ¡†å’Œç±»åˆ«ä¿¡æ¯ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†YOLOæ¨¡å‹çš„è®­ç»ƒæµç¨‹ï¼Œæ¶µç›–äº†ä»æ•°æ®å‡†å¤‡åˆ°æ¨¡å‹è®­ç»ƒå’Œè¯„ä¼°çš„å„ä¸ªæ–¹é¢ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ç›®æ ‡æ£€æµ‹è®­ç»ƒæ¡†æ¶ã€‚

#### 11.5 ultralytics\nn\extra_modules\rep_block.py

ä»¥ä¸‹æ˜¯ç»è¿‡ç®€åŒ–å¹¶æ³¨é‡Šçš„æ ¸å¿ƒä»£ç éƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬äº† `DiverseBranchBlock` ç±»åŠå…¶ç›¸å…³æ–¹æ³•ï¼š

```python
import torch
import torch.nn as nn
import torch.nn.functional as F

# å®šä¹‰ä¸€ä¸ªå¤šåˆ†æ”¯å—çš„ç±»
class DiverseBranchBlock(nn.Module):
    def __init__(self, in_channels, out_channels, kernel_size,
                 stride=1, padding=None, dilation=1, groups=1,
                 internal_channels_1x1_3x3=None,
                 deploy=False, single_init=False):
        super(DiverseBranchBlock, self).__init__()
        self.deploy = deploy  # æ˜¯å¦éƒ¨ç½²æ¨¡å¼
        self.nonlinear = Conv.default_act  # éçº¿æ€§æ¿€æ´»å‡½æ•°
        self.kernel_size = kernel_size  # å·ç§¯æ ¸å¤§å°
        self.out_channels = out_channels  # è¾“å‡ºé€šé“æ•°
        self.groups = groups  # åˆ†ç»„å·ç§¯çš„ç»„æ•°
        
        # è®¡ç®—å¡«å……ï¼Œå¦‚æœæœªæŒ‡å®šåˆ™è‡ªåŠ¨è®¡ç®—
        if padding is None:
            padding = autopad(kernel_size, padding, dilation)
        assert padding == kernel_size // 2  # ç¡®ä¿å¡«å……æ­£ç¡®

        # éƒ¨ç½²æ¨¡å¼ä¸‹çš„å·ç§¯å±‚
        if deploy:
            self.dbb_reparam = nn.Conv2d(in_channels=in_channels, out_channels=out_channels, kernel_size=kernel_size, stride=stride,
                                      padding=padding, dilation=dilation, groups=groups, bias=True)
        else:
            # åŸå§‹å·ç§¯å’Œæ‰¹å½’ä¸€åŒ–å±‚
            self.dbb_origin = self.conv_bn(in_channels, out_channels, kernel_size, stride, padding, dilation, groups)

            # å¹³å‡æ± åŒ–å’Œæ‰¹å½’ä¸€åŒ–å±‚
            self.dbb_avg = self.create_avg_branch(in_channels, out_channels, kernel_size, stride, padding, groups)

            # 1x1å·ç§¯å’Œkxkå·ç§¯çš„ç»„åˆ
            self.dbb_1x1_kxk = self.create_1x1_kxk_branch(in_channels, out_channels, kernel_size, padding, groups, internal_channels_1x1_3x3)

        # å•ä¸€åˆå§‹åŒ–é€‰é¡¹
        if single_init:
            self.single_init()

    def conv_bn(self, in_channels, out_channels, kernel_size, stride, padding, dilation, groups):
        """åˆ›å»ºå·ç§¯å’Œæ‰¹å½’ä¸€åŒ–å±‚çš„ç»„åˆ"""
        conv_layer = nn.Conv2d(in_channels, out_channels, kernel_size, stride=stride, padding=padding, dilation=dilation, groups=groups, bias=False)
        bn_layer = nn.BatchNorm2d(out_channels)
        return nn.Sequential(conv_layer, bn_layer)

    def create_avg_branch(self, in_channels, out_channels, kernel_size, stride, padding, groups):
        """åˆ›å»ºå¹³å‡æ± åŒ–å’Œæ‰¹å½’ä¸€åŒ–å±‚çš„ç»„åˆ"""
        avg_branch = nn.Sequential()
        avg_branch.add_module('avg', nn.AvgPool2d(kernel_size=kernel_size, stride=stride, padding=padding))
        avg_branch.add_module('avgbn', nn.BatchNorm2d(out_channels))
        return avg_branch

    def create_1x1_kxk_branch(self, in_channels, out_channels, kernel_size, padding, groups, internal_channels):
        """åˆ›å»º1x1å·ç§¯å’Œkxkå·ç§¯çš„ç»„åˆ"""
        branch = nn.Sequential()
        branch.add_module('conv1', nn.Conv2d(in_channels, internal_channels, kernel_size=1, groups=groups, bias=False))
        branch.add_module('bn1', nn.BatchNorm2d(internal_channels))
        branch.add_module('conv2', nn.Conv2d(internal_channels, out_channels, kernel_size=kernel_size, padding=0, groups=groups, bias=False))
        branch.add_module('bn2', nn.BatchNorm2d(out_channels))
        return branch

    def forward(self, inputs):
        """å‰å‘ä¼ æ’­"""
        if hasattr(self, 'dbb_reparam'):
            return self.nonlinear(self.dbb_reparam(inputs))  # éƒ¨ç½²æ¨¡å¼ç›´æ¥ä½¿ç”¨é‡å‚æ•°åŒ–å·ç§¯

        # åŸå§‹å·ç§¯å’Œå…¶ä»–åˆ†æ”¯çš„è¾“å‡ºç›¸åŠ 
        out = self.dbb_origin(inputs)
        if hasattr(self, 'dbb_1x1'):
            out += self.dbb_1x1(inputs)
        out += self.dbb_avg(inputs)
        out += self.dbb_1x1_kxk(inputs)
        return self.nonlinear(out)  # åº”ç”¨éçº¿æ€§æ¿€æ´»å‡½æ•°

    def single_init(self):
        """å•ä¸€åˆå§‹åŒ–æ–¹æ³•"""
        self.init_gamma(0.0)  # åˆå§‹åŒ–ä¸º0
        if hasattr(self, "dbb_origin"):
            torch.nn.init.constant_(self.dbb_origin.bn.weight, 1.0)  # åŸå§‹å·ç§¯çš„æƒé‡åˆå§‹åŒ–ä¸º1
```

### ä»£ç è¯´æ˜ï¼š
1. **DiverseBranchBlock ç±»**ï¼šè¯¥ç±»å®ç°äº†ä¸€ä¸ªå¤šåˆ†æ”¯å·ç§¯å—ï¼Œæ”¯æŒå¤šç§å·ç§¯æ“ä½œçš„ç»„åˆï¼Œé€‚ç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­ã€‚
2. **æ„é€ å‡½æ•° `__init__`**ï¼šåˆå§‹åŒ–å·ç§¯å±‚ã€æ‰¹å½’ä¸€åŒ–å±‚åŠå…¶ç»„åˆã€‚æ ¹æ®æ˜¯å¦åœ¨éƒ¨ç½²æ¨¡å¼ä¸‹é€‰æ‹©ä¸åŒçš„å±‚ç»“æ„ã€‚
3. **`conv_bn` æ–¹æ³•**ï¼šåˆ›å»ºå·ç§¯å±‚å’Œæ‰¹å½’ä¸€åŒ–å±‚çš„ç»„åˆã€‚
4. **`create_avg_branch` æ–¹æ³•**ï¼šåˆ›å»ºå¹³å‡æ± åŒ–å’Œæ‰¹å½’ä¸€åŒ–å±‚çš„ç»„åˆã€‚
5. **`create_1x1_kxk_branch` æ–¹æ³•**ï¼šåˆ›å»º1x1å·ç§¯å’Œkxkå·ç§¯çš„ç»„åˆã€‚
6. **`forward` æ–¹æ³•**ï¼šå®šä¹‰å‰å‘ä¼ æ’­è¿‡ç¨‹ï¼Œè®¡ç®—è¾“å…¥çš„è¾“å‡ºã€‚
7. **`single_init` æ–¹æ³•**ï¼šå®ç°å•ä¸€åˆå§‹åŒ–ï¼Œè®¾ç½®æƒé‡ä¸ºç‰¹å®šå€¼ã€‚

é€šè¿‡è¿™äº›æ ¸å¿ƒéƒ¨åˆ†å’Œæ³¨é‡Šï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£è¯¥æ¨¡å—çš„åŠŸèƒ½å’Œç»“æ„ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º `DiverseBranchBlock` çš„ç¥ç»ç½‘ç»œæ¨¡å—ï¼Œä¸»è¦ç”¨äºæ·±åº¦å­¦ä¹ ä¸­çš„å·ç§¯æ“ä½œã€‚æ–‡ä»¶ä¸­åŒ…å«äº†ä¸€äº›è¾…åŠ©å‡½æ•°å’Œç±»ï¼Œæ—¨åœ¨å®ç°ä¸åŒçš„å·ç§¯å’Œå½’ä¸€åŒ–æ“ä½œï¼Œä»¥æé«˜æ¨¡å‹çš„æ€§èƒ½å’Œçµæ´»æ€§ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶å¯¼å…¥äº†å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬ `torch` å’Œ `torch.nn`ï¼Œè¿™äº›æ˜¯æ„å»ºå’Œè®­ç»ƒç¥ç»ç½‘ç»œçš„åŸºç¡€åº“ã€‚æ¥ç€ï¼Œå®šä¹‰äº†ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œä¾‹å¦‚ `transI_fusebn`ã€`transII_addbranch` ç­‰ï¼Œè¿™äº›å‡½æ•°ä¸»è¦ç”¨äºå¤„ç†å·ç§¯æ ¸å’Œåç½®çš„è½¬æ¢ã€åˆå¹¶ç­‰æ“ä½œã€‚è¿™äº›å‡½æ•°çš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åœ¨ä¸åŒçš„å·ç§¯å±‚ä¹‹é—´è¿›è¡Œå‚æ•°çš„èåˆå’Œå¤„ç†ï¼Œä»¥ä¾¿åœ¨æ¨ç†æ—¶èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ä½¿ç”¨æ¨¡å‹ã€‚

`conv_bn` å‡½æ•°æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç»„åˆå±‚ï¼Œç»“åˆäº†å·ç§¯å±‚å’Œæ‰¹å½’ä¸€åŒ–å±‚ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«å·ç§¯å’Œæ‰¹å½’ä¸€åŒ–çš„åºåˆ—ï¼Œæ–¹ä¾¿åœ¨æ¨¡å‹ä¸­ä½¿ç”¨ã€‚

`IdentityBasedConv1x1` ç±»ç»§æ‰¿è‡ª `nn.Conv2d`ï¼Œå®ç°äº†ä¸€ç§ç‰¹æ®Šçš„ 1x1 å·ç§¯å±‚ï¼Œèƒ½å¤Ÿåœ¨å·ç§¯æ“ä½œä¸­ä¿ç•™è¾“å…¥çš„ç‰¹å¾ã€‚è¿™ä¸€å±‚é€šè¿‡æ„é€ ä¸€ä¸ªèº«ä»½çŸ©é˜µæ¥å®ç°è¿™ä¸€ç‚¹ï¼Œç¡®ä¿è¾“å…¥ç‰¹å¾åœ¨ç»è¿‡è¯¥å±‚æ—¶ä¸ä¼šä¸¢å¤±ã€‚

`BNAndPadLayer` ç±»åˆ™æ˜¯ä¸€ä¸ªç»“åˆäº†æ‰¹å½’ä¸€åŒ–å’Œå¡«å……æ“ä½œçš„å±‚ã€‚å®ƒåœ¨æ‰¹å½’ä¸€åŒ–ä¹‹åå¯¹è¾“å‡ºè¿›è¡Œå¡«å……ï¼Œä»¥ä¿æŒç‰¹å¾å›¾çš„å°ºå¯¸ä¸å˜ã€‚

`DiverseBranchBlock` ç±»æ˜¯è¯¥æ–‡ä»¶çš„æ ¸å¿ƒï¼Œæ„é€ å‡½æ•°ä¸­æ¥å—å¤šä¸ªå‚æ•°æ¥å®šä¹‰è¾“å…¥è¾“å‡ºé€šé“ã€å·ç§¯æ ¸å¤§å°ã€æ­¥å¹…ã€å¡«å……ç­‰ã€‚æ ¹æ®æ˜¯å¦åœ¨éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæ¨¡å—ä¼šé€‰æ‹©ä¸åŒçš„å®ç°æ–¹å¼ã€‚è¯¥æ¨¡å—åŒ…å«å¤šä¸ªåˆ†æ”¯ï¼ŒåŒ…æ‹¬åŸå§‹å·ç§¯ã€1x1 å·ç§¯ã€å¹³å‡æ± åŒ–ç­‰ï¼Œæ¯ä¸ªåˆ†æ”¯éƒ½ç»è¿‡æ‰¹å½’ä¸€åŒ–å¤„ç†ã€‚æ¨¡å—çš„è®¾è®¡ä½¿å¾—åœ¨è®­ç»ƒå’Œæ¨ç†é˜¶æ®µéƒ½èƒ½æœ‰æ•ˆåœ°ä½¿ç”¨ä¸åŒçš„å·ç§¯ç»“æ„ã€‚

åœ¨ `forward` æ–¹æ³•ä¸­ï¼Œå®šä¹‰äº†å‰å‘ä¼ æ’­çš„è¿‡ç¨‹ï¼Œè®¡ç®—è¾“å…¥ç»è¿‡å„ä¸ªåˆ†æ”¯åçš„è¾“å‡ºï¼Œå¹¶å°†ç»“æœç›¸åŠ ã€‚è¿™ä¸ªè¿‡ç¨‹å…è®¸æ¨¡å‹åœ¨ä¸åŒçš„å·ç§¯è·¯å¾„ä¸­æå–ç‰¹å¾ï¼Œä»è€Œå¢å¼ºæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚

æ­¤å¤–ï¼Œ`DiverseBranchBlock` è¿˜æä¾›äº†ä¸€äº›åˆå§‹åŒ–å’Œè½¬æ¢çš„æ–¹æ³•ï¼Œå¦‚ `get_equivalent_kernel_bias` å’Œ `switch_to_deploy`ï¼Œç”¨äºåœ¨è®­ç»ƒå’Œæ¨ç†é˜¶æ®µä¹‹é—´åˆ‡æ¢æ¨¡å‹çš„å‚æ•°å½¢å¼ï¼Œä»¥æé«˜æ¨ç†æ•ˆç‡ã€‚

æ€»ä½“è€Œè¨€ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ä¸ªçµæ´»ä¸”é«˜æ•ˆçš„å·ç§¯æ¨¡å—ï¼Œèƒ½å¤Ÿåœ¨æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­æä¾›å¤šæ ·åŒ–çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### æ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

Ultralytics YOLOé¡¹ç›®æ˜¯ä¸€ä¸ªç”¨äºç›®æ ‡æ£€æµ‹çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå…·æœ‰æ¨¡å—åŒ–çš„è®¾è®¡ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚é¡¹ç›®çš„æ•´ä½“åŠŸèƒ½åŒ…æ‹¬æ¨¡å‹çš„æ„å»ºã€è®­ç»ƒã€æ¨ç†å’Œç»“æœå¤„ç†ã€‚å„ä¸ªæ¨¡å—ä¹‹é—´é€šè¿‡æ¸…æ™°çš„æ¥å£è¿›è¡Œäº¤äº’ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒå’Œè¯„ä¼°ã€‚

- **ç»“æœå¤„ç†æ¨¡å—** (`results.py`): è´Ÿè´£å¤„ç†æ¨¡å‹æ¨ç†çš„ç»“æœï¼ŒåŒ…æ‹¬æ£€æµ‹æ¡†ã€æ©è†œå’Œå…³é”®ç‚¹ç­‰ï¼Œæä¾›äº†å¯è§†åŒ–å’Œä¿å­˜ç»“æœçš„åŠŸèƒ½ã€‚
- **å›è°ƒç®¡ç†æ¨¡å—** (`__init__.py`): ç®¡ç†è®­ç»ƒè¿‡ç¨‹ä¸­çš„å›è°ƒå‡½æ•°ï¼Œæ”¯æŒç›‘æ§å’Œè°ƒæ•´è®­ç»ƒè¿‡ç¨‹çš„å„ç§æ“ä½œã€‚
- **æ¨¡å‹æ„å»ºæ¨¡å—** (`fasternet.py`): å®šä¹‰äº†ä¸€ä¸ªé«˜æ•ˆçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ç»“æ„ï¼Œæä¾›äº†å¤šç§ç»„ä»¶å’Œæ¨¡å—ï¼Œç”¨äºå›¾åƒç‰¹å¾æå–ã€‚
- **è®­ç»ƒæ¨¡å—** (`train.py`): å®ç°äº†YOLOæ¨¡å‹çš„è®­ç»ƒæµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€é¢„å¤„ç†ã€æ¨¡å‹è®­ç»ƒå’ŒéªŒè¯ç­‰åŠŸèƒ½ã€‚
- **é¢å¤–æ¨¡å—** (`rep_block.py`): æä¾›äº†å¤šæ ·åŒ–çš„å·ç§¯æ“ä½œå’Œå±‚ç»“æ„ï¼Œå¢å¼ºäº†æ¨¡å‹çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                           | åŠŸèƒ½æè¿°                                                                                   |
|--------------------------------------------------|------------------------------------------------------------------------------------------|
| `ultralytics/engine/results.py`                  | å¤„ç†æ¨¡å‹æ¨ç†ç»“æœï¼ŒåŒ…æ‹¬æ£€æµ‹æ¡†ã€æ©è†œå’Œå…³é”®ç‚¹ï¼Œæä¾›å¯è§†åŒ–å’Œä¿å­˜ç»“æœçš„åŠŸèƒ½ã€‚                      |
| `ultralytics/utils/callbacks/__init__.py`       | ç®¡ç†è®­ç»ƒè¿‡ç¨‹ä¸­çš„å›è°ƒå‡½æ•°ï¼Œæ”¯æŒç›‘æ§å’Œè°ƒæ•´è®­ç»ƒè¿‡ç¨‹çš„å„ç§æ“ä½œã€‚                              |
| `ultralytics/nn/backbone/fasternet.py`          | å®šä¹‰é«˜æ•ˆçš„æ·±åº¦å­¦ä¹ æ¨¡å‹ç»“æ„ï¼Œæä¾›å¤šç§ç»„ä»¶å’Œæ¨¡å—ï¼Œç”¨äºå›¾åƒç‰¹å¾æå–ã€‚                          |
| `ultralytics/models/yolo/detect/train.py`       | å®ç°YOLOæ¨¡å‹çš„è®­ç»ƒæµç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®åŠ è½½ã€é¢„å¤„ç†ã€æ¨¡å‹è®­ç»ƒå’ŒéªŒè¯ç­‰åŠŸèƒ½ã€‚                      |
| `ultralytics/nn/extra_modules/rep_block.py`     | æä¾›å¤šæ ·åŒ–çš„å·ç§¯æ“ä½œå’Œå±‚ç»“æ„ï¼Œå¢å¼ºæ¨¡å‹çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚                                     |

è¿™ä¸ªè¡¨æ ¼æ€»ç»“äº†æ¯ä¸ªæ–‡ä»¶çš„ä¸»è¦åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿç†è§£é¡¹ç›®çš„ç»“æ„å’Œå„ä¸ªæ¨¡å—çš„ä½œç”¨ã€‚

### 13.å›¾ç‰‡ã€è§†é¢‘ã€æ‘„åƒå¤´å›¾åƒåˆ†å‰²Demo(å»é™¤WebUI)ä»£ç 

åœ¨è¿™ä¸ªåšå®¢å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨ä¸ä½¿ç”¨WebUIçš„æƒ…å†µä¸‹ï¼Œå®ç°å›¾åƒåˆ†å‰²æ¨¡å‹çš„ä½¿ç”¨ã€‚æœ¬é¡¹ç›®ä»£ç å·²ç»ä¼˜åŒ–æ•´åˆï¼Œæ–¹ä¾¿ç”¨æˆ·å°†åˆ†å‰²åŠŸèƒ½åµŒå…¥è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚
æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ã€æ‘„åƒå¤´å›¾åƒçš„åˆ†å‰²ï¼ŒROIåŒºåŸŸçš„è½®å»“æå–ã€ç±»åˆ«åˆ†ç±»ã€å‘¨é•¿è®¡ç®—ã€é¢ç§¯è®¡ç®—ã€åœ†åº¦è®¡ç®—ä»¥åŠé¢œè‰²æå–ç­‰ã€‚
è¿™äº›åŠŸèƒ½æä¾›äº†è‰¯å¥½çš„äºŒæ¬¡å¼€å‘åŸºç¡€ã€‚

### æ ¸å¿ƒä»£ç è§£è¯»

ä»¥ä¸‹æ˜¯ä¸»è¦ä»£ç ç‰‡æ®µï¼Œæˆ‘ä»¬ä¼šä¸ºæ¯ä¸€å—ä»£ç è¿›è¡Œè¯¦ç»†çš„æ‰¹æ³¨è§£é‡Šï¼š

```python
import random
import cv2
import numpy as np
from PIL import ImageFont, ImageDraw, Image
from hashlib import md5
from model import Web_Detector
from chinese_name_list import Label_list

# æ ¹æ®åç§°ç”Ÿæˆé¢œè‰²
def generate_color_based_on_name(name):
    ......

# è®¡ç®—å¤šè¾¹å½¢é¢ç§¯
def calculate_polygon_area(points):
    return cv2.contourArea(points.astype(np.float32))

...
# ç»˜åˆ¶ä¸­æ–‡æ ‡ç­¾
def draw_with_chinese(image, text, position, font_size=20, color=(255, 0, 0)):
    image_pil = Image.fromarray(cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
    draw = ImageDraw.Draw(image_pil)
    font = ImageFont.truetype("simsun.ttc", font_size, encoding="unic")
    draw.text(position, text, font=font, fill=color)
    return cv2.cvtColor(np.array(image_pil), cv2.COLOR_RGB2BGR)

# åŠ¨æ€è°ƒæ•´å‚æ•°
def adjust_parameter(image_size, base_size=1000):
    max_size = max(image_size)
    return max_size / base_size

# ç»˜åˆ¶æ£€æµ‹ç»“æœ
def draw_detections(image, info, alpha=0.2):
    name, bbox, conf, cls_id, mask = info['class_name'], info['bbox'], info['score'], info['class_id'], info['mask']
    adjust_param = adjust_parameter(image.shape[:2])
    spacing = int(20 * adjust_param)

    if mask is None:
        x1, y1, x2, y2 = bbox
        aim_frame_area = (x2 - x1) * (y2 - y1)
        cv2.rectangle(image, (x1, y1), (x2, y2), color=(0, 0, 255), thickness=int(3 * adjust_param))
        image = draw_with_chinese(image, name, (x1, y1 - int(30 * adjust_param)), font_size=int(35 * adjust_param))
        y_offset = int(50 * adjust_param)  # ç±»åˆ«åç§°ä¸Šæ–¹ç»˜åˆ¶ï¼Œå…¶ä¸‹æ–¹ç•™å‡ºç©ºé—´
    else:
        mask_points = np.concatenate(mask)
        aim_frame_area = calculate_polygon_area(mask_points)
        mask_color = generate_color_based_on_name(name)
        try:
            overlay = image.copy()
            cv2.fillPoly(overlay, [mask_points.astype(np.int32)], mask_color)
            image = cv2.addWeighted(overlay, 0.3, image, 0.7, 0)
            cv2.drawContours(image, [mask_points.astype(np.int32)], -1, (0, 0, 255), thickness=int(8 * adjust_param))

            # è®¡ç®—é¢ç§¯ã€å‘¨é•¿ã€åœ†åº¦
            area = cv2.contourArea(mask_points.astype(np.int32))
            perimeter = cv2.arcLength(mask_points.astype(np.int32), True)
            ......

            # è®¡ç®—è‰²å½©
            mask = np.zeros(image.shape[:2], dtype=np.uint8)
            cv2.drawContours(mask, [mask_points.astype(np.int32)], -1, 255, -1)
            color_points = cv2.findNonZero(mask)
            ......

            # ç»˜åˆ¶ç±»åˆ«åç§°
            x, y = np.min(mask_points, axis=0).astype(int)
            image = draw_with_chinese(image, name, (x, y - int(30 * adjust_param)), font_size=int(35 * adjust_param))
            y_offset = int(50 * adjust_param)

            # ç»˜åˆ¶é¢ç§¯ã€å‘¨é•¿ã€åœ†åº¦å’Œè‰²å½©å€¼
            metrics = [("Area", area), ("Perimeter", perimeter), ("Circularity", circularity), ("Color", color_str)]
            for idx, (metric_name, metric_value) in enumerate(metrics):
                ......

    return image, aim_frame_area

# å¤„ç†æ¯å¸§å›¾åƒ
def process_frame(model, image):
    pre_img = model.preprocess(image)
    pred = model.predict(pre_img)
    det = pred[0] if det is not None and len(det)
    if det:
        det_info = model.postprocess(pred)
        for info in det_info:
            image, _ = draw_detections(image, info)
    return image

if __name__ == "__main__":
    cls_name = Label_list
    model = Web_Detector()
    model.load_model("./weights/yolov8s-seg.pt")

    # æ‘„åƒå¤´å®æ—¶å¤„ç†
    cap = cv2.VideoCapture(0)
    while cap.isOpened():
        ret, frame = cap.read()
        if not ret:
            break
        ......

    # å›¾ç‰‡å¤„ç†
    image_path = './icon/OIP.jpg'
    image = cv2.imread(image_path)
    if image is not None:
        processed_image = process_frame(model, image)
        ......

    # è§†é¢‘å¤„ç†
    video_path = ''  # è¾“å…¥è§†é¢‘çš„è·¯å¾„
    cap = cv2.VideoCapture(video_path)
    while cap.isOpened():
        ret, frame = cap.read()
        ......
```


### 14.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+50+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/Z5WblZxs](https://mbd.pub/o/bread/Z5WblZxs)